/*
 *
 * Wijmo Library 1.0.0
 * http://wijmo.com/
 *
 * Copyright(c) ComponentOne, LLC.  All rights reserved.
 * 
 * Dual licensed under the Wijmo Commercial or GNU GPL Version 3 licenses.
 * licensing@wijmo.com
 * http://wijmo.com/license
 *
 *
 **/
(function(a){a.widget("wijmo.wijgrid",{options:{allowColSizing:false,allowKeyboardNavigation:false,allowPaging:false,allowSorting:false,allowEditing:false,columns:[],culture:"",customFilterOperators:[],data:null,filterOperatorsSortMode:"alphabeticalCustomFirst",groupIndent:10,nullString:undefined,pageIndex:0,pageSize:10,pagerSettings:{mode:"numeric",pageButtonCount:10,position:"bottom"},rowFormatter:undefined,scrollMode:"none",selectionMode:"singleRow",showFilter:false,showRowHeader:false,staticRowIndex:-1,key_reverse:false,key_pageSize:10,aftercelledit:null,aftercellupdate:null,beforecelledit:null,beforecellupdate:null,currentcellchanging:null,currentcellchanged:null,filteroperatorslistshowing:null,groupaggregate:null,grouptext:null,invalidcellvalue:null,pageindexchanging:null,pageindexchanged:null,selectionchanged:null,sorting:null,sorted:null},_staticColumnIndex:-1,_ajaxError:function(){this.outerDiv.removeClass("wijmo-wijgrid-loading")},_dataLoading:function(){this.outerDiv.addClass("wijmo-wijgrid-loading")},_dataLoaded:function(a){this.outerDiv.removeClass("wijmo-wijgrid-loading");this._requiresDataBinding=false;this.doRefresh(a)},_ensureControl:function(b){b={data:null,callback:a.isFunction(b)?b:null};if(this._initialized){this._ownerise(false);this._widgetsToOptions()}else this._prepareColumnsOptions();this._ownerise(true);if(this._requiresDataBinding)this._dataStore.load(b);else this.doRefresh(b)},doRefresh:function(e){if(!this._initialized)try{this._prepareColumnsOptions()}catch(o){throw o;}finally{this._initialized=true}this._rebuildLeaves();var i=this._dataStore.getDataSlice(),m=i.data,j,g,c,l,k,b,d,n,h,f;if(this.options.allowPaging){j=Math.ceil(i.totalRows/this.options.pageSize)||1;this._field("pageCount",j)}g=this._field("leaves");this.dataTable=[];for(c=0,l=m.length;c<l;c++){k=m[c];b=[];for(d=0,n=g.length;d<n;d++){h=g[d];if(a.wijmo.wijgrid.validDataKey(h.dataKey)){f=k[h.dataKey];b.push({value:f.value,originalRowIndex:f.originalRowIndex})}}b.rowType=a.wijmo.wijgrid.rowType.data;if(c%2!==0)b.rowType|=a.wijmo.wijgrid.rowType.dataAlt;b.__style={};b.__attr={};this.dataTable.push(b)}this._refresh();e&&e.callback&&e.callback()},_prepareColumnsOptions:function(){a.wijmo.wijgrid.traverse(this.options.columns,function(b){b.isBand=a.isArray(b.columns)||b.clientType==="c1band"});(new a.wijmo.wijgrid.bandProcessor)._getVisibleHeight(this.options.columns,true);var e=a.wijmo.wijgrid.getAllLeaves(this.options.columns),h,l,g=null,p,c,i,f,k,j,b,d,o,n,m;if(this._dataStore.isLoaded()){h=this._dataStore.getFieldsCount();l=this._dataStore.dataMode()===a.wijmo.wijgrid.dataMode.dom;if(l){if(this._field("thead")&&this._field("thead").length)g=this._field("thead")[0];h=Math.max(g?g.length:0,h)}p=h-e.length;for(c=0;c<p;c++){i=a.extend(true,{},a.wijmo.c1basefield.prototype.options,a.wijmo.c1field.prototype.options);i=a.extend({dynamic:true,isLeaf:true},i);this.options.columns.push(i)}this._extendColumnOptions()}a.wijmo.wijgrid.setTraverseIndex(this.options.columns);e=[];a.wijmo.wijgrid.traverse(this.options.columns,a.proxy(function(a){a.isLeaf&&!a.isBand&&e.push(a)},this));if(this._dataStore.isLoaded()){f=this._dataStore.getFieldsNames();k=[];for(c=0,j=e.length;c<j;c++){b=e[c];d=b.dataKey;if(a.wijmo.wijgrid.validDataKey(d)){if(typeof d==="string")d=d.toLowerCase();if(f[d])delete f[d]}else k.push(b)}c=0;for(o in f)if(f.hasOwnProperty(o)){d=f[o];if(!isNaN(d))d=parseInt(d,10);b=k[c++];if(b)b.dataKey=d}for(c=0,j=e.length;c<j;c++){b=e[c];if(b.headerText===undefined){n=false;if(l){m=typeof b.dataKey==="number"?b.dataKey:c;if(g&&m<g.length){b.headerText=g[m];n=true}}if(!n)if(a.wijmo.wijgrid.validDataKey(b.dataKey))b.headerText=""+b.dataKey}}}this._field("leaves",e)},_rebuildLeaves:function(){var b=[],c=[],d=0,e=0;this.options.showRowHeader&&b.push(a.extend({dynamic:true,clientType:"c1basefield",dataIndex:-1,travIdx:-1,parentVis:true,visible:true,isLeaf:true,isBand:false,owner:this},a.wijmo.c1basefield.prototype.options,{allowSizing:false}));a.each(this.options.columns,function(c,a){b.push(a)});this._field("spanTable",(new a.wijmo.wijgrid.bandProcessor).generateSpanTable(b,c));this._field("leaves",c);this._field("visibleLeaves",a.grep(c,function(b,c){b.leavesIdx=c;if(a.wijmo.wijgrid.validDataKey(b.dataKey))b.dataIndex=e++;else b.dataIndex=-1;if(b.parentVis){b.visLeavesIdx=d++;return true}return false}))},_create:function(){this.rendered=false;this._requiresDataBinding=true;this._dataStore=new a.wijmo.wijgrid.dataStore(this);if(!this.element.is("table"))throw"invalid markup";this.element.addClass("wijmo-wijgrid-root");this.element.wrap('<div class="ui-widget wijmo-wijgrid ui-widget-content ui-corner-all"></div>');this.outerDiv=this.element.parent();this.element[0].style.height&&this.outerDiv.css("height",this.element[0].style.height);this.element[0].style.width&&this.outerDiv.css("width",this.element[0].style.width);this.element.css({height:"",width:""});this.filterOperatorsCache=new a.wijmo.wijgrid.filterOperatorsCache;this._registerFilterOperator(a.wijmo.wijgrid.embeddedFilters);this.options.disabled&&this.disable();this.cellFormatter=new a.wijmo.wijgrid.cellFormatterHelper},_init:function(){__wijReadOptionEvents(["currentcellchanging","currentcellchanged","filteroperatorslistshowing","groupaggregate","grouptext","pageindexchanging","pageindexchanged","selectionchanged","sorting","sorted","beforecelledit","beforecellupdate","aftercellupdate","aftercelledit","invalidcellvalue"],this);this.$topPagerDiv=null;this.$bottomPagerDiv=null;this.filterOperatorsCache.removeCustom();a.each(this.options.customFilterOperators,function(b,a){a.custom=true});this._registerFilterOperator(this.options.customFilterOperators);this._field("closestCulture",a.findClosestCulture(this.options.culture));this.options.data===null&&!this._field("thead")&&this._field("thead",(new a.wijmo.wijgrid.htmlTableDataReader(this)).readTHead());this._initialized=false;this._ensureControl()},_setOption:function(e,b){var g=this["_preset_"+e],d=this.options[e],f,c;if(g!==undefined)b=g.apply(this,[b,d]);f=b!==d;a.Widget.prototype._setOption.apply(this,arguments);if(f){c=this["_postset_"+e];c!==undefined&&c.apply(this,[b,d])}},destroy:function(){this._detachEvents();var b;(b=this._field("resizer"))&&b.dispose();a.wijmo.wijgrid.iterateChildrenWidgets(this.outerDiv,function(b,a){a.destroy()});this.element.insertBefore(this.outerDiv);this.outerDiv.remove();(b=this._field("selectionui"))&&b.dispose();this.element.removeData("closestCulture").removeData("columns").removeData("currentCell").removeData("headerRowsAccessor").removeData("leaves").removeData("resizer").removeData("selection").removeData("selectionui").removeData("spanTable").removeData("view").removeData("visibleLeaves");a.Widget.prototype.destroy.apply(this,arguments)},columns:function(){return this._field("columns")||[]},currentCell:function(c,d){var b;if(arguments.length===0){b=this._field("currentCell");!b&&this._field("currentCell",b=a.wijmo.wijgrid.cellInfo.prototype.outsideValue);return b}else{b=arguments.length===1?c._clone():new a.wijmo.wijgrid.cellInfo(c,d);if(!b.isEqual(a.wijmo.wijgrid.cellInfo.prototype.outsideValue)){if(!b._isValid())throw"invalid arguments";b._clip(this._getDataCellsRange())}b._setGridView(this);this._changeCurrentCell(b);return this._field("currentCell")}},data:function(){return this._dataStore.dataSource().items},selection:function(){var b=this._field("selection");!b&&this._field("selection",b=new a.wijmo.wijgrid.selection(this));return b},beginEdit:function(){return this._beginEditInternal(null)},endEdit:function(){return this._endEditInternal(null)},pageCount:function(){return this._field("pageCount")||1},_headerRows:function(){var b=this._field("headerRowsAccessor"),c;if(!b){c=this.options.showFilter?1:0;this._field("headerRowsAccessor",b=new a.wijmo.wijgrid.rowAccessor(this._field("view"),1,0,c))}return b},_filterRow:function(){if(this.options.showFilter){var b=new a.wijmo.wijgrid.rowAccessor(this._field("view"),1,0,0);return b.item(b.length()-1)}return null},_rows:function(){var b=this._field("rowsAccessor");!b&&this._field("rowsAccessor",b=new a.wijmo.wijgrid.rowAccessor(this._field("view"),2,0,0));return b},_selectionui:function(){var b=this._field("selectionui");!b&&this._field("selectionui",b=new a.wijmo.wijgrid.selectionui(this));return b},_registerFilterOperator:function(c){var b,d;if(c&&a.isArray(c))for(b=0,d=c.length;b<d;b++)this.filterOperatorsCache.add(c[b]);else for(b=0,d=arguments.length;b<d;b++)this.filterOperatorsCache.add(arguments[b])},_postset_allowSorting:function(){this._ensureControl()},_postset_columns:function(){throw"read-only";},_postset_allowPaging:function(){this._requiresDataBinding=true;this._ensureControl()},_postset_culture:function(){throw"read-only";},_postset_customFilterOperators:function(b){this.filterOperatorsCache.removeCustom();a.each(this.options.customFilterOperators,function(b,a){a.custom=true});this._registerFilterOperator(b)},_postset_data:function(){throw"read-only";},_postset_disabled:function(b){a.wijmo.wijgrid.iterateChildrenWidgets(this.outerDiv,function(c,a){a.option("disabled",b)})},_postset_groupIndent:function(){this._ensureControl()},_preset_pageIndex:function(a,c){if(isNaN(a))throw"out of range";var b=this.pageCount();if(a>b-1)a=b-1;if(a<0)a=0;if(this.options.allowPaging&&a!==c)if(!this._trigger("pageindexchanging",null,{newPageIndex:a}))a=c;return a},_postset_pageIndex:function(){if(this.options.allowPaging){this._requiresDataBinding=true;this._ensureControl(a.proxy(function(){this._trigger("pageindexchanged",null)},this))}},_preset_pageSize:function(a){if(isNaN(a))throw"out of range";if(a<=0)a=1;return a},_postset_pageSize:function(){this.options.pageIndex=0;if(this.options.allowPaging){this._requiresDataBinding=true;this._ensureControl()}},_postset_pagerSettings:function(){this._ensureControl()},_postset_scrollMode:function(b,a){if(b==="none"||a==="none")this._ensureControl();else this._field("view").refreshPanel()},_postset_selectionMode:function(){var c=this.selection(),b=this.currentCell();c.beginUpdate();c.clear();b&&b._isValid()&&c._selectRange(new a.wijmo.wijgrid.cellInfoRange(b,b),false,false,0,null);c.endUpdate()},_postset_showFilter:function(){this._ensureControl()},_postset_showRowHeader:function(){this._ensureControl()},_postset_staticRowIndex:function(){this.options.scrollMode!=="none"&&this._ensureControl()},_columnWidgetsFactory:function(d,b){var c,e=b.clientType;if(!e&&b.isBand)e="c1band";b=a.extend({owner:this},b,{disabled:this.options.disabled});switch(e){case"c1basefield":c=d.c1basefield(b);break;case"c1boundfield":c=d.c1boundfield(b);break;case"c1band":c=d.c1band(b);break;default:c=d.c1field(b)}return c},_field:function(a,b){return arguments.length===1?this.element.data(a):this.element.data(a,b)},_extendColumnOptions:function(){a.wijmo.wijgrid.traverse(this.options.columns,a.proxy(function(b){b.isBand=a.isArray(b.columns)||b.clientType==="c1band";a.wijmo.wijgrid.shallowMerge(b,a.wijmo.c1basefield.prototype.options);if(!b.isBand){a.wijmo.wijgrid.shallowMerge(b,a.wijmo.c1field.prototype.options);if(!b.clientType)b.clientType="c1field";switch(b.dataType){case undefined:case"string":if(!b.dataParser)b.dataParser=wijgridStringParser;break;case"boolean":if(!b.dataParser)b.dataParser=wijgridBoolParser;break;case"number":if(!b.dataParser)b.dataParser=wijgridNumberParser;break;case"currency":if(!b.dataParser)b.dataParser=wijgridCurrencyParser;break;case"datetime":if(!b.dataParser)b.dataParser=wijgridDateTimeParser;break;default:throw a.wijmo.wijgrid.stringFormat('Unsupported dataType value: "{0}"',b.dataType);}if(a.isFunction(b.dataParser))b.dataParser=new b.dataParser}else b.clientType="c1band"},this))},_buildFilterInfo:function(d){var b=this._field("leaves"),c;if(!b)return[];c=a.map(b,a.proxy(function(b){if(!b.isBand&&a.wijmo.wijgrid.validDataKey(b.dataKey)&&b.filterOperator){var e=b.filterOperator.toLowerCase(),c;if(e!=="nofilter"&&(c=this.filterOperatorsCache.getByName(e)))if(a.inArray(b.dataType||"string",c.applicableTo)>=0)if(c.arity===1||c.arity>1&&b.filterValue!==undefined)return d?[{column:b,operator:c}]:[{dataKey:b.dataKey,filterOperator:b.filterOperator,filterValue:b.filterValue}]}return null},this));return c},_buildSortInfo:function(){var b=this._field("leaves"),c;if(!b)return[];c=a.map(b,function(b){var c=null;if((b.visible||b.visible===undefined)&&!b.isBand&&a.wijmo.wijgrid.validDataKey(b.dataKey))c=b.sortDirection==="ascending"||b.sortDirection==="descending"||b.sortFlag?[{dataKey:b.dataKey,sortDirection:b.sortDirection}]:null;delete b.sortFlag;return c});return c},_widgetsToOptions:function(){var b=a.wijmo.wijgrid.flatten(this.options.columns);a.wijmo.wijgrid.traverse(this.columns(),function(c){var d=b[c.options.travIdx];a.extend(true,d,c.options)})},_recreateColumnWidgets:function(){a.each(this.columns(),function(b,a){a.destroy()});var h=[],f=this._headerRows(),b,d,i,c,g,j,e;if(f&&f.length()){b=[];a.wijmo.wijgrid.traverse(this.options.columns,function(a){a.parentVis&&b.push(a)});for(d=0,i=b.length;d<i;d++){c=b[d];g=f.item(c.thY);j=(new a.wijmo.wijgrid.rowAccessor).getCell(g,c.thX);e=this._columnWidgetsFactory(a(j),c);h.push(e.data(e.data("widgetName")))}}this._field("columns",h)},_ownerise:function(b){if(b){var c=this;a.wijmo.wijgrid.traverse(this.options.columns,function(d){d.owner=c;var a,b,e;if(a=d.groupInfo){a.owner=d;if(a.expandInfo)for(b=0,e=a.expandInfo.length;b<e;b++)a.expandInfo[b].owner=a}})}else a.wijmo.wijgrid.traverse(this.options.columns,function(c){delete c.owner;var a,b,d;if(a=c.groupInfo){delete a.owner;if(a.expandInfo)for(b=0,d=a.expandInfo.length;b<d;b++)delete a.expandInfo[b].owner}})},_updateSplits:function(){this._field("view").updateSplits!==null&&this._field("view").updateSplits()},_refresh:function(){this.element.detach();this.element.empty();this.outerDiv.empty();this.outerDiv.append(this.element);if(this._field("selectionui")){this._field("selectionui").dispose();this._field("selectionui",null)}this._field("headerRowsAccessor")&&this._field("headerRowsAccessor",null);this._field("rowsAccessor")&&this._field("rowsAccessor",null);this._field("resizer")&&this._field("resizer").dispose();(new a.wijmo.wijgrid.grouper).group(this,this.dataTable,this._field("leaves"));(new a.wijmo.wijgrid.merger).merge(this.dataTable,this._field("visibleLeaves"));var c,b,d,e=[];if(this.options.scrollMode!=="none"&&(this._staticColumnIndex>=0||this.options.staticRowIndex>=0))this._field("view",c=new a.wijmo.wijgrid.fixedView(this));else this._field("view",c=new a.wijmo.wijgrid.flatView(this));c.initialize();this._render();this._ownerise(false);this._recreateColumnWidgets();this._ownerise(true);if(this.options.allowPaging){this.$topPagerDiv&&this.$topPagerDiv.wijpager(this._pagerSettings2PagerWidgetSettings());this.$bottomPagerDiv&&this.$bottomPagerDiv.wijpager(this._pagerSettings2PagerWidgetSettings())}this._attachEvents();a(c.focusableElement()).attr("tabIndex",0);if(this.currentCell()._isValid())this.currentCell(this.currentCell());else this.currentCell(new a.wijmo.wijgrid.cellInfo(0,0));this._field("selection",null);b=this.currentCell();if(b._isValid()){this.selection()._startNewTransaction(b);this.selection()._selectRange(new a.wijmo.wijgrid.cellInfoRange(b,b),false,false,0,null)}this._selectionui();d=new a.wijmo.wijgrid.resizer(this);a.wijmo.wijgrid.traverse(this.columns(),function(b){var a=b.options;a.visible&&a.parentVis&&a.isLeaf&&d.addElement(b)});this._field("resizer",d);this.rendered=true;this._updateSplits();a.wijmo.wijgrid.traverse(this.columns(),function(b){if(b instanceof a.wijmo.c1field){var c=b._getFilterEditorWidth();c!==undefined&&e.push({widget:b,width:c})}});a.each(e,function(b,a){a.widget._setFilterEditorWidth(a.width)})},_render:function(){var c=this._field("view"),b;c.render(255);b=this.outerDiv;if(this.options.scrollMode!=="none")if(this.options.staticRowIndex>=0)b=this.outerDiv.find("div.wijmo-wijgrid-scroller:first");else b=this.outerDiv.find(".wijmo-wijgrid-content-area");if(this.$topPagerDiv){this.$topPagerDiv.data("wijpager")&&this.$topPagerDiv.wijpager("destroy");this.$topPagerDiv.remove()}this.$topPagerDiv=null;if(this.options.allowPaging&&(this.options.pagerSettings.position==="top"||this.options.pagerSettings.position==="topAndBottom"))!this.$topPagerDiv&&b.prepend(this.$topPagerDiv=a('<div class="wijmo-wijgrid-header wijmo-wijsuperpanel-header ui-widget-header ui-corner-top"></div>'));if(this.$bottomPagerDiv){this.$bottomPagerDiv.data("wijpager")&&this.$bottomPagerDiv.wijpager("destroy");this.$bottomPagerDiv.remove()}this.$bottomPagerDiv=null;if(this.options.allowPaging&&(this.options.pagerSettings.position==="bottom"||this.options.pagerSettings.position==="topAndBottom"))!this.$bottomPagerDiv&&b.append(this.$bottomPagerDiv=a('<div class="wijmo-wijgrid-footer wijmo-wijsuperpanel-footer ui-state-default ui-corner-bottom"></div>'))},_attachEvents:function(){var b=this._field("view"),c=a(b.focusableElement());c.bind("keydown."+this.widgetName,a.proxy(this._onKeyDown,this));c.bind("keypress."+this.widgetName,a.proxy(this._onKeyPress,this));a.each(b.subTables(),a.proxy(function(d,c){var b=c.element();if(b){b.tHead&&a(b.tHead).bind("click."+this.widgetName,a.proxy(this._onClick,this));b.tBodies.length&&a(b.tBodies[0]).bind("click."+this.widgetName,a.proxy(this._onClick,this)).bind("dblclick."+this.widgetName,a.proxy(this._onDblClick,this)).bind("mousemove."+this.widgetName,a.proxy(this._onMouseMove,this)).bind("mouseout."+this.widgetName,a.proxy(this._onMouseOut,this))}},this));a.each(b.getJoinedTables(true,0),a.proxy(function(d,b){if(b&&typeof b!=="number"){var c=b.element();a(c).find("> tbody").find("> tr.wijmo-wijgrid-groupheaderrow > td .wijmo-wijgrid-grouptogglebtn").bind("click."+this.widgetName,a.proxy(this._onGroupBtnClick,this))}},this));b.attachEvents()},_detachEvents:function(){var c=this._field("view"),d=a(c.focusableElement()),b=this;d.unbind("."+this.widgetName);a.each(c.subTables(),function(){var c=this.element();if(c){c.tHead&&a(c.tHead).unbind("."+b.widgetName);c.tBodies.length&&a(c.tBodies[0]).unbind("."+b.widgetName)}});a.each(c.getJoinedTables(true,0),function(d,c){c&&typeof c!=="number"&&a(c.element()).find("> tbody").find("> tr.wijmo-wijgrid-groupheaderrow > td .wijmo-wijgrid-grouptogglebtn").unbind("."+b.widgetName)})},_sortBy:function(b){if(this.options.allowSorting){b.options.sortFlag=true;var c=this.columns(),d=a.inArray(b,c);if(d>=0){a.each(c,function(c,a){if(a!==b)a.options.sortDirection="none"});this._requiresDataBinding=true;this._ensureControl(a.proxy(function(){b.options.sortFlag=false},this))}}},_pagerSettings2PagerWidgetSettings:function(){return a.extend({},this.options.pagerSettings,{disabled:this.options.disabled,pageCount:this.pageCount(),pageIndex:this.options.pageIndex,pageindexchanging:a.proxy(this._onPagerWidgetPageIndexChanging,this),pageindexchanged:a.proxy(this._onPagerWidgetPageIndexChanged,this)})},_onPagerWidgetPageIndexChanging:function(b,a){a.handled=true},_onPagerWidgetPageIndexChanged:function(b,a){this._setOption("pageIndex",a.newPageIndex)},_onClick:function(d){if(!this._canInteract()||!d.target)return;var i=this._getParentSubTable(d.target,["td","th"],this._field("view").subTables()),j,h,g,b,f=0,e,c;if(i){j=this._field("view");h=i[0];g=a(h).closest("tr");if(!(g.is(".wijmo-wijgrid-datarow")||g.is(".wijmo-wijgrid-headerrow")))return;if(!g.length)return;b=j.getAbsCellInfo(h)._dataToAbs(this._getDataToAbsOffset());if(b.cellIndex()<0||b.rowIndex()<0)if(b.rowIndex()>=0){b=new a.wijmo.wijgrid.cellInfo(0,b.rowIndex());f=2}else{b=new a.wijmo.wijgrid.cellInfo(b.cellIndex(),0);f=1}this._changeCurrentCell(b);e=this.currentCell();c=this.selection();(!d.shiftKey||!c._multipleRangesAllowed()&&this.options.selectionMode.toLowerCase()!=="singlerange")&&c._startNewTransaction(e);c.beginUpdate();if(d.shiftKey&&d.ctrlKey)c._clearRange(new a.wijmo.wijgrid.cellInfoRange(e,e),f);else c._selectRange(new a.wijmo.wijgrid.cellInfoRange(c._anchorCell(),e),d.ctrlKey,d.shiftKey,f,null);c.endUpdate()}},_onDblClick:function(a){this._beginEditInternal(a)},_onGroupBtnClick:function(e){var g=a(e.target).closest("tr"),f=new a.wijmo.wijgrid.groupHelper,c=f.getGroupInfo(g[0]),d,b;if(c){d=f.getColumnByGroupLevel(this._field("leaves"),c.level);if(d){b=d.groupInfo.expandInfo[c.index];if(b.isExpanded)b.collapse(e.shiftKey);else b.expand(e.shiftKey);this._field("view").ensureWidth()}}},_onKeyDown:function(b){if(!this._canInteract)return true;var d=b.target.tagName.toLowerCase(),g=false,f,h,e,c;if((d==="input"||d==="option"||d==="select"||d==="textarea")&&a(b.target).closest("tr.wijmo-wijgrid-datarow").length===0)return true;if(this.options.allowEditing)if(b.which===113){this._beginEditInternal(b);return false}else if(b.which===a.ui.keyCode.ESCAPE&&(this.currentCell()._isValid()&&this.currentCell()._isEdit())){this._endEditInternal(b);return false}if(!this.options.allowKeyboardNavigation)return true;switch(b.which){case a.ui.keyCode.LEFT:case a.ui.keyCode.RIGHT:case a.ui.keyCode.DOWN:case a.ui.keyCode.UP:case a.ui.keyCode.PAGE_DOWN:case a.ui.keyCode.PAGE_UP:case a.ui.keyCode.HOME:case a.ui.keyCode.END:case a.ui.keyCode.TAB:f=this._getNextCurrencyPos(this._getDataCellsRange(),this.currentCell(),b.keyCode,b.shiftKey);g=this._canMoveToAnotherCell(b.target,b.which)}if(g){h=this._changeCurrentCell(new a.wijmo.wijgrid.cellInfo(f.cellIndex,f.rowIndex));e=this.currentCell();c=this.selection();(!b.shiftKey||!c._multipleRangesAllowed()&&this.options.selectionMode.toLowerCase()!=="singlerange")&&c._startNewTransaction(e);c.beginUpdate();c._selectRange(new a.wijmo.wijgrid.cellInfoRange(c._anchorCell(),e),false,b.shiftKey,0,null);c.endUpdate();return false}return true},_onKeyPress:function(c){if(this._canInteract()&&this.options.allowEditing){var g=c.which,f=this.currentCell(),b,d,e;if(g&&f._isValid()&&!f._isEdit()){b=c.target.tagName.toLowerCase();if(b!=="input"&&b!=="option"&&b!=="select"&&b!=="textarea"){d=a(c.target).closest(".wijmo-wijgrid-table");if(d.length){e=a.map(this._field("view").subTables(),function(a){return a.element()});if(a.inArray(d[0],e)>=0)if(a.wij.charValidator.isPrintableChar(String.fromCharCode(g))){this._beginEditInternal(c);return false}}}}}},_onMouseMove:function(i){if(!this._canInteract())return;var h=this._field("view"),g=this._getParentSubTable(i.target,["td","th"],h.subTables()),f,d,e,c,b;if(g){f=g[0];d=a(f).closest("tr");if(!d.length||d.is(".wijmo-wijgrid-foorow")||!(d.is(".wijmo-wijgrid-datarow")||d.is(".wijmo-wijgrid-headerrow")))return;e=h.getAbsCellInfo(f)._dataToAbs(this._getDataToAbsOffset());c=this._field("hoveredRow");if(e.rowIndex()!==c){b=this._rows().item(c);if(b){b[0]&&a(b[0]).removeClass("ui-state-hover");b[1]&&a(b[1]).removeClass("ui-state-hover")}}c=e.rowIndex();this._field("hoveredRow",c);if(c>=0){b=this._rows().item(c);if(b){b[0]&&a(b[0]).addClass("ui-state-hover");b[1]&&a(b[1]).addClass("ui-state-hover")}}}},_onMouseOut:function(c){if(a(c.relatedTarget).closest(".wijmo-wijgrid-data").length===0){var b=this._field("hoveredRow");b>=0&&a.each(this._rows().item(b),function(c,b){a(b).removeClass("ui-state-hover")})}},_fieldResized:function(b,a){if(a<=0)a=1;b.option("width",a)},_changeCurrentCell:function(b){var d=null,a=this.currentCell(),c=this._getDataCellsRange(),f,e;if(c._isValid()&&c._containsCellInfo(b)||b.isEqual(b.outsideValue))if(a.cellIndex()!==b.cellIndex()||a.rowIndex()!==b.rowIndex()){f={cellIndex:b.cellIndex(),rowIndex:b.rowIndex(),oldCellIndex:a.cellIndex(),oldRowIndex:a.rowIndex()};if(this._trigger("currentcellchanging",null,f)){e=false;if(!this.options.allowEditing||!a._isEdit()||(e=this._endEditInternal(null))){c._containsCellInfo(a)&&this._changeCurrentCellUI(a,false);a=b._clone();a._setGridView(this);d=this._changeCurrentCellUI(a,true);this._field("currentCell",a);this._trigger("currentcellchanged")}}}else d=this._changeCurrentCellUI(a,true);return d},_changeCurrentCellUI:function(c,h){if(c&&!c.isEqual(c.outsideValue)){var f=this._field("view"),j=this._field("visibleLeaves"),i=this._getDataToAbsOffset(),e=c.cellIndex()+i.x,g=c.rowIndex()+i.y,d,b;if(g>=0){d=f.getJoinedRows(g,0);if(d&&d[0]&&this.options.showRowHeader)if(h)a(d[0].cells[0]).addClass("ui-state-active wijmo-wijgrid-currency-rowheadercell");else a(d[0].cells[0]).removeClass("ui-state-active wijmo-wijgrid-currency-rowheadercell");if(e>=0&&e<j.length){b=f.getHeaderCell(e);if(b)if(h)a(b).addClass("ui-state-active wijmo-wijgrid-currency-headercell");else a(b).removeClass("ui-state-active wijmo-wijgrid-currency-headercell");b=f.getCell(e,g);if(b)if(h)a(b).addClass("ui-state-active wijmo-wijgrid-currency-cell");else a(b).removeClass("ui-state-active wijmo-wijgrid-currency-cell")}return f.getCell(e,g)}}return null},_beginEditInternal:function(d){if(this._canInteract()&&this.options.allowEditing){var c=this.currentCell().column(),b;if(c&&!c.readOnly){b=(new a.wijmo.wijgrid.cellEditorHelper).currentCellEditStart(this,d);b;return b}}return false},_endEditInternal:function(c){if(this._canInteract()&&this.options.allowEditing){var d=this.currentCell().column(),b=(new a.wijmo.wijgrid.cellEditorHelper).currentCellEditEnd(this,c);b;return b}return false},_rowCreated:function(b,c,e,d){if(!b)b=c;a.isFunction(this.options.rowFormatter)&&this.options.rowFormatter([b,c],e,d)},_parseDOM:function(a,b){return a.dataParser.parseDOM(b,this._field("closestCulture"),a.dataFormatString,this.options.nullString)},_parse:function(a,b){return a.dataParser.parse(b,this._field("closestCulture"),a.dataFormatString,this.options.nullString)},_toStr:function(a,b){return a.dataParser.toStr(b,this._field("closestCulture"),a.dataFormatString,this.options.nullString)},_canInteract:function(){return!this.options.disabled},_canMoveToAnotherCell:function(d,c){var h=d.tagName.toLowerCase(),f,e,b,g;switch(h){case"input":if(a(d).hasClass("wijgridinput")){if(d.type==="text"){f=d.value.length;e=(new a.wijmo.wijgrid.domSelection(d)).getSelection();b=a.ui.keyCode;g=c===b.UP||c===b.DOWN||c===b.PAGE_DOWN||c===b.PAGE_UP||e.length===0&&(e.start===0&&(c===b.LEFT||c===b.HOME)||e.end>=f&&(c===b.RIGHT||c===b.END));return g}return true}return false;case"textarea":case"select":return false}return true},_getDataToAbsOffset:function(){var c=0,a=0,b=this._headerRows();if(this.options.showRowHeader)c++;if(b)a+=b.length();if(this._filterRow())a++;return{x:c,y:a}},_getDataCellsRange:function(){var d=0,e=0,b=this._field("visibleLeaves").length-1,c=this.dataTable.length-1;if(this.options.showRowHeader)b--;if(b<0||c<0)d=e=b=c=-1;return new a.wijmo.wijgrid.cellInfoRange(new a.wijmo.wijgrid.cellInfo(d,e),new a.wijmo.wijgrid.cellInfo(b,c))},_getNextCurrencyPos:function(b,f,h,g){var d=f.cellIndex(),c=f.rowIndex(),e;switch(h){case a.ui.keyCode.PAGE_UP:if(this.options.key_reverse&&c===b.topLeft().rowIndex())c=b.bottomRight().rowIndex();else{c-=this.options.key_pageSize;if(c<(e=b.topLeft().rowIndex()))c=e}break;case a.ui.keyCode.PAGE_DOWN:if(this.options.key_reverse&&c===b.bottomRight().rowIndex())c=b.TopLeft().RowIndex();else{c+=this.options.key_pageSize;if(c>(e=b.bottomRight().rowIndex()))c=e}break;case a.ui.keyCode.END:d=this.options.key_reverse&&d===b.bottomRight().cellIndex()?b.topLeft().cellIndex():b.bottomRight().cellIndex();break;case a.ui.keyCode.HOME:d=this.options.key_reverse&&d===b.topLeft().cellIndex()?b.bottomRight().cellIndex():b.topLeft().cellIndex();break;case a.ui.keyCode.LEFT:if(d>b.topLeft().cellIndex())d--;else if(this.options.key_reverse)d=b.bottomRight().cellIndex();break;case a.ui.keyCode.UP:if(c>b.topLeft().rowIndex())c--;else if(this.options.key_reverse)c=b.bottomRight().rowIndex();break;case a.ui.keyCode.RIGHT:if(d<b.bottomRight().cellIndex())d++;else if(this.options.key_reverse)d=b.topLeft().cellIndex();break;case a.ui.keyCode.ENTER:case a.ui.keyCode.DOWN:if(c<b.bottomRight().rowIndex())c++;else if(this.options.key_reverse)c=b.topLeft().rowIndex();break;case a.ui.keyCode.TAB:if(false)if(g){d--;if(d<b.topLeft().cellIndex()){d=b.bottomRight().cellIndex();c--;if(c<b.topLeft().rowIndex())c=b.bottomRight().rowIndex()}}else{d++;if(d>b.bottomRight().cellIndex()){d=b.topLeft().cellIndex();c++;if(c>b.bottomRight().rowIndex())c=b.topLeft().rowIndex()}}}return{cellIndex:d,rowIndex:c}},_getParentSubTable:function(b,g,h){for(var f=a.map(h,function(a){return a.element()}),c=null,d=null,e;b!==null&&c===null;b=b.parentNode){e=b.tagName?b.tagName.toLowerCase():undefined;if(a.inArray(e,g)>=0)d=b;else if(a.inArray(b,f)>=0)c=b}return d&&c?[d,c]:null},_getRealStaticRowIndex:function(){if(this.options.staticRowIndex>=0){var a=this._field("spanTable").length-1;if(this.options.showFilter)a++;return a}else return this.options.staticRowIndex}})})(jQuery);(function(a){a.widget("wijmo.c1basefield",{options:{allowSizing:true,dataKey:undefined,cellFormatter:undefined,headerText:undefined,visible:true,width:undefined},_create:function(){this.element.addClass("ui-widget wijmo-c1basefield ui-state-default");this._field("owner",this.options.owner);delete this.options.owner;this._field("widgetName",this.widgetName);this.options.disabled&&this.disable()},_init:function(){this.element.text(this.options.headerText);this.element.wrapInner("<div class='wijmo-wijgrid-innercell'><span class=\"wijmo-wijgrid-headertext\" /></div>")},_field:function(a,b){return arguments.length===1?this.element.data(a):this.element.data(a,b)},_setOption:function(e,b){var g=this["_preset_"+e],d=this.options[e],f,c;if(g!==undefined)b=g.apply(this,[b,d]);f=b!==d;a.Widget.prototype._setOption.apply(this,arguments);if(f){c=this["_postset_"+e];c!==undefined&&c.apply(this,[b,d])}},_preset_clientType:function(){throw"read-only";},_postset_headerText:function(){},_postset_visible:function(){this._field("owner")._ensureControl()},_postset_width:function(a){var b=this._field("owner"),c=b._field("view");c.ensureWidth(a,this.options.visLeavesIdx)},_canSize:function(){return this.options.allowSizing&&this._field("owner").options.allowColSizing}})})(jQuery);(function(a){a.widget("wijmo.c1field",a.wijmo.c1basefield,{options:{aggregate:"none",allowSort:true,dataType:"string",dataParser:undefined,dataFormatString:undefined,filterOperator:"nofilter",filterValue:undefined,groupInfo:{expandInfo:[],groupSingleRow:true,collapsedImageClass:"ui-icon-plus",expandedImageClass:"ui-icon-minus",position:"none",outlineMode:"startExpanded",headerText:undefined,footerText:undefined},readOnly:false,rowMerge:"none",showFilter:true,sortDirection:"none",valueRequired:false},_create:function(){a.wijmo.c1basefield.prototype._create.apply(this,arguments);this.element.addClass("ui-widget wijmo-c1field")},destroy:function(){a.wijmo.c1basefield.prototype.destroy.apply(this,arguments);if(this.$filterEditor){switch(this.options.dataType){case"number":case"currency":this.$filterEditor.wijinputnumber("destroy");break;case"datetime":this.$filterEditor.wijinputdate("destroy");break;default:this.$filterEditor.wijinputmask("destroy")}this.$filterEditor=null}this._removeDropDownFilterList()},_init:function(){a.wijmo.c1basefield.prototype._init.apply(this,arguments);this.$filterEditor=null;this._refreshHeaderCell();var b=this._field("owner");this.filterRow=b._filterRow();b.options.showFilter&&this.options.showFilter&&this.options.dataIndex>=0&&this._prepareFilterCell()},_setOption:function(){a.wijmo.c1basefield.prototype._setOption.apply(this,arguments)},_postset_aggregate:function(){this._field("owner")._ensureControl()},_postset_allowSort:function(){this.element.find("#contentCell").empty();this._refreshHeaderCell()},_postset_dataType:function(){throw"read-only";},_postset_dataParser:function(){this._field("owner")._ensureControl()},_postset_dataFormatString:function(){this._field("owner")._ensureControl()},_postset_filterOperator:function(){this._field("owner")._requiresDataBinding=true;this._field("owner")._ensureControl()},_postset_filterValue:function(){this._field("owner")._requiresDataBinding=true;this._field("owner")._ensureControl()},_postset_groupInfo:function(){this._field("owner")._ensureControl()},_postset_rowMerge:function(){this._field("owner")._ensureControl()},_postset_showFilter:function(){this._field("owner")._ensureControl()},_preset_sortDirection:function(a,b){var c=this._field("owner");if(!c._trigger("sorting",null,this))a=b;return a},_postset_sortDirection:function(){var a=this._field("owner");a._sortBy(this);a._trigger("sorted",null,this)},_postset_width:function(){this._setFilterEditorWidth(1);a.wijmo.c1basefield.prototype._postset_width.apply(this,arguments);this._setFilterEditorWidth(this._getFilterEditorWidth())},_canSort:function(){var a=this._field("owner");return a&&a.options.allowSorting&&this.options.allowSort&&this.options.dataIndex>=0},_refreshHeaderCell:function(){var b=this.element.children(".wijmo-wijgrid-innercell").empty(),c;b.text(this.options.headerText);if(this._canSort()){b.wrapInner('<a class="wijmo-wijgrid-headertext" href="#" role="button" />');c=b.children("a").bind("click."+this.widgetName,this,this._onHrefClick);switch(this.options.sortDirection){case"ascending":c.append(a('<span class="ui-icon ui-icon-triangle-1-n">ascending</span>'));break;case"descending":c.append(a('<span class="ui-icon ui-icon-triangle-1-s">descending</span>'))}}else b.wrapInner('<span class="wijmo-wijgrid-headertext" />')},_prepareFilterCell:function(){var e=this.options.visLeavesIdx,c=null,d=null,b;if(e>=0){c=this._field("owner");if(this.filterRow)d=a((new a.wijmo.wijgrid.rowAccessor).getCell(this.filterRow,e));else throw"exception";d.find(".wijmo-wijgrid-filtericon").attr("class",this._getFilterOpIconCss(c,this.options.filterOperator));this.$filterEditor=d.find("input");b=c._parse(this.options,this.options.filterValue);switch(this.options.dataType){case undefined:if(b===null)b="";case"boolean":if(b===null)b=false;case"string":if(b===null)b="";this.$filterEditor.wijinputmask({disabled:c.options.disabled,text:b});break;case"number":if(b!==null)this.$filterEditor.wijinputnumber({disabled:c.options.disabled,value:b});else this.$filterEditor.wijinputnumber({disabled:c.options.disabled});break;case"datetime":if(b!==null)this.$filterEditor.wijinputdate({disabled:c.options.disabled,date:b});else this.$filterEditor.wijinputdate({disabled:c.options.disabled});break;case"currency":if(b!==null)this.$filterEditor.wijinputnumber({disabled:c.options.disabled,type:"currency",value:b});else this.$filterEditor.wijinputnumber({disabled:c.options.disabled,type:"currency"})}d.find(".wijmo-wijgrid-filter-trigger").attr({role:"button","aria-haspopup":"true"}).bind("mouseenter",function(){a(this).addClass("ui-state-hover")}).bind("mouseleave",function(){a(this).removeClass("ui-state-hover ui-state-active")}).bind("mouseup",this,function(){a(this).removeClass("ui-state-active")}).bind("mousedown",{column:this},this._onFilterBtnClick).bind("click",function(a){a.preventDefault()})}},_onFilterBtnClick:function(k){var b=k.data.column,c,i,g,d,f,h,e,j;if(b.$dropDownFilterList){b._removeDropDownFilterList();return false}c=b._field("owner");i=k.data.column.options.filterOperator.toLowerCase();g=c.filterOperatorsCache.getByDataType(b.options.dataType);c.filterOperatorsCache.sort(g,c.options.filterOperatorsSortMode);d=a.extend(true,{},{operators:g});c._trigger("filteroperatorslistshowing",null,d);f=[];if(d.operators)for(h in d.operators)if(d.operators.hasOwnProperty(h)){e=d.operators[h];f.push({label:e.name,value:e.name,selected:e.name.toLowerCase()===i})}b.$dropDownFilterList=a('<div class="wijmo-wijgrid-filterlist"></div').appendTo(document.body).wijlist({autoSize:true,maxItemsCount:8,selected:function(g,f){var e=c.filterOperatorsCache.getByName(f.item.value),d=false,a;b._removeDropDownFilterList();if(e)if(e.arity>1){a=c._parse(b.options,b.$filterEditor.val());if(a!==null&&(b.options.dataType==="string"||!isNaN(a))){b.options.filterValue=a;d=true}}else d=true;if(d){b.options.filterOperator=e.name;c.options.pageIndex=0;c._requiresDataBinding=true;c._ensureControl()}}});b.$dropDownFilterList.wijlist("setItems",f).wijlist("renderList");f.length>8&&b.$dropDownFilterList.width(b.$dropDownFilterList.width()+20);b.$dropDownFilterList.$button=a(this);b.$dropDownFilterList.wijlist("refreshSuperPanel").position({of:a(this),my:"left top",at:"left bottom"});j=b.$dropDownFilterList.eventGuid=(new Date).getTime();a(document).bind("mousedown."+b.widgetName+"."+j,{column:b},b._onDocMouseDown)},_getFilterOpIconCss:function(d,c){var b="filter-nofilter",a=d.filterOperatorsCache.getByName(c.toLowerCase());if(a)if(a.css)b=a.css;else b="filter-"+a.name.toLowerCase();return"wijmo-wijgrid-filtericon "+b},_onDocMouseDown:function(c){var b=a(c.target),e=b.parents(".wijmo-wijgrid-filterlist:first"),d=b.is(".wijmo-wijgrid-filter-trigger")?b:b.parents(".wijmo-wijgrid-filter-trigger:first");!(d.length&&d[0]===c.data.column.$dropDownFilterList.$button[0]||e.length&&e[0]===c.data.column.$dropDownFilterList[0])&&c.data.column._removeDropDownFilterList()},_onHrefClick:function(b){if(b.data.options.disabled)return false;if(b.data.options.allowSort){var a=b.data.options.sortDirection;a=a==="none"?"ascending":a==="ascending"?"descending":"ascending";b.data.option("sortDirection",a)}return false},_removeDropDownFilterList:function(){if(this.$dropDownFilterList){var b=this.$dropDownFilterList.eventGuid;this.$dropDownFilterList.remove();this.$dropDownFilterList=null;a(document).unbind("mousedown."+this.widgetName+"."+b,this._onDocMouseDown)}},_getFilterEditorWidth:function(){if(this.$filterEditor){var b=this.$filterEditor.closest(".wijmo-wijgrid-filter"),a=b.width()-b.find(".wijmo-wijgrid-filtericon").outerWidth();if(!a||a<0)a=0;return a}return undefined},_setFilterEditorWidth:function(a){if(this.$filterEditor){a-=this.$filterEditor.leftBorderWidth()+this.$filterEditor.rightBorderWidth();if(a<0)a=0;switch(this.options.dataType){case"number":case"currency":this.$filterEditor.wijinputnumber("widget").width(a);break;case"datetime":this.$filterEditor.wijinputdate("widget").width(a);break;default:this.$filterEditor.wijinputmask("widget").width(a)}this.$filterEditor.setOutWidth(a)}},_somemethod:function(){}})})(jQuery);(function(a){a.widget("wijmo.c1band",a.wijmo.c1basefield,{options:{columns:[]},_create:function(){a.wijmo.c1basefield.prototype._create.apply(this,arguments);this.element.addClass("ui-widget wijmo-c1band")}})})(jQuery);$.extend($.wijmo.wijgrid,{bandProcessor:function(){var b,g,a,f,d,e,c;this.generateSpanTable=function(j,i){b=g=e=d=0;a=[];f=[];c=[];var h=this._generateSpanTable(j,i,true);return h};this._generateSpanTable=function(h,d,i){var c,e;b=this._getVisibleHeight(h,i);d=d||[];$.wijmo.wijgrid.traverse(h,function(a){a.isLeaf&&d.push(a);f.push(a)});g=d.length;for(c=0;c<b;c++){a[c]=[];for(e=0;e<g;e++)a[c][e]={column:null,colSpan:0,rowSpan:0}}this._setTableValues(h,0,0);return a};this._getVisibleHeight=function(a,f){var c,d,g,e,b=0;if($.isArray(a))for(c=0,d=a.length;c<d;c++){e=this._getVisibleHeight(a[c],f);b=Math.max(b,e)}else{g=a.visible===undefined?true:a.visible;a.parentVis=g&&f;if(a.isBand){for(c=0,d=a.columns.length;c<d;c++){e=this._getVisibleHeight(a.columns[c],a.parentVis);b=Math.max(b,e)}if(!a.parentVis)return b;a.isLeaf=b===0;b++}else{a.isLeaf=true;if(a.parentVis)b=1}}return b};this._getVisibleParent=function(a){while(a){a=f[a.parentIdx];if(a&&(a.parentVis||a.parentVis===undefined))return a}return null};this._setTableValues=function(f,g,m){var h,k,l,i,n,j;if($.isArray(f))for(h=0,k=f.length;h<k;h++)this._setTableValues(f[h],g,m);else{if(f.travIdx===undefined)throw"undefined travIdx";l=m+d;if(f.parentVis){i=l+e;a[g][i].column=f;c[f.travIdx]=i}if(f.isBand)for(h=0,k=f.columns.length;h<k;h++)this._setTableValues(f.columns[h],g+1,m);if(f.parentVis)if(d-l===0){a[g][c[f.travIdx]].rowSpan=b-g;d++}else a[g][c[f.travIdx]].colSpan=d-l;else if(!f.isBand&&b>0){j=this._getVisibleParent(f);n=j?j.isLeaf:false;if(n)e++;if(g>=b)g=b-1;i=m+d+e;a[g][i].column=f;if(!n){j&&c[j.travIdx]===i&&this._shiftTableElements(i,g);e++}}}};this._shiftTableElements=function(d,e){for(var b=0;b<e;b++){a[b][d+1]=a[b][d];a[b][d]={column:null,colSpan:0,rowSpan:0};if(a[b][d+1].column)c[a[b][d+1].column.travIdx]++}}},getAllLeaves:function(b){var a=[];this._getAllLeaves(b,a);return a},_getAllLeaves:function(d,e){var c,f,a,b;if(d)for(c=0,f=d.length;c<f;c++){a=d[c];if(a.options){if($.isFunction(a.columns))b=a.columns()}else b=a.columns;if(b&&b.length)this._getAllLeaves(b,e);else e.push(a)}},getColumnByTravIdx:function(d,e){var c,g,a,b,f=null;if(d)for(c=0,g=d.length;c<g&&!f;c++){a=d[c];if(a.options){if(a._field("travIdx")===e)return a;if($.isFunction(a.columns))b=a.columns()}else{if(a.travIdx===e)return a;b=a.columns}if(b)f=this.getColumnByTravIdx(b,e)}return f},getLeaves:function(b){var a=[];this._getLeaves(b,a);return a},_getLeaves:function(c,d){var b,e,a;if(c)for(b=0,e=c.length;b<e;b++){a=c[b];a.isLeaf&&d.push(a);this._getLeaves(a.columns,d)}},setTraverseIndex:function(a){return this._setTraverseIndex(a,0,-1)},_setTraverseIndex:function(e,b,f){var d,g,a,c;if(e)for(d=0,g=e.length;d<g;d++){a=e[d];if(a.options){a._field("travIdx",b++);a._field("parentIdx",f);if($.isFunction(a.columns))c=a.columns()}else{a.travIdx=b++;a.parentIdx=f;c=a.columns}if(c)b=this._setTraverseIndex(c,b,b-1)}return b},flatten:function(b){var a=[];this.traverse(b,function(b){a.push(b)});return a},traverse:function(e,d){var b,f,a,c;if(e&&$.isFunction(d))for(b=0,f=e.length;b<f;b++){a=e[b];d(a);c=$.isFunction(a.columns)?a.columns():a.columns;c&&this.traverse(c,d)}},getAriaHeaders:function(d,g){var a,f,b,c,e=[];for(a=0,f=d.length;a<f;a++){b=d[a];c="";do c+=escape(b.headerText)+" ";while(b=g[b.parentIdx]);e[a]=$.trim(c)}return e}});$.extend($.wijmo.wijgrid,{htmlTableDataReader:function(a){this.readTHead=function(){var i=a.element,e,f,c,j,g,d,b,h;if(!i.length)throw"table not found";e=[];f=i[0].tHead;if(f)for(c=0,j=1;c<j;c++){g=f.rows[c];d=[];for(b=0,h=g.cells.length;b<h;b++)d.push(g.cells[b].innerHTML);e.push(d)}return e};this.readTBody=function(){var i=a.element.find(" > table"),f,d,c,j,g,e,b,h;if(!i.length)throw"table not found";f=[];d=i.find("> tbody");if(d.length)for(c=0,j=d[0].rows.length;c<j;c++){g=d[0].rows[c];e=[];for(b=0,h=g.cells.length;b<h;b++)e[b]={value:g.cells[b].innerHTML,originalRowIndex:c};f.push(e)}return f}}});$.extend($.wijmo.wijgrid,{dataMode:{dom:1,statical:2,remoteStatical:4,dynamical:8},dataStore:function(b){var a=null,l=this,d=false,c=null,g,f=false,e=false;this.dataMode=function(){return j()};this.dataSource=function(){return a};this.getFieldsCount=function(){if(!d)throw"data is not loaded yet";return a.items&&a.items.length?p(a.items[0]):0};this.getFieldsNames=function(){if(!d)throw"data is not loaded yet";var f=[],b,c,e;if(a.items&&a.items.length){e=a.items[0];for(b in e)if(e.hasOwnProperty(b)){c=b;if(typeof c==="string")c=b.toLowerCase();f[c]=b}}return f};this.getDataSlice=function(){if(!d)throw"data is not loaded yet";if(!f){f=true;q()}if(!e){e=true;if(j()!==$.wijmo.wijgrid.dataMode.dynamical)g=r();else g={data:$.extend(true,[],c),totalRows:a.data.totalRows}}return g};this.load=function(c){if(!a)a=$.proxy(n,this)(b);if(j()===$.wijmo.wijgrid.dataMode.dynamical){c.data=o();if(a.proxy)a.proxy.options.data=$.extend(a.proxy.options.data,c.data);a.load(c,true)}else if(!d)a.load(c);else{h(a,c);i(a,c)}};this.isLoaded=function(){return d};this.updateValue=function(b,f,e){if(!d)throw"data is not loaded yet";a.items[b][f]=e;c[b][f]=e};function n(d){var a=null,b=d.options.data,c;if(b===null)a=new wijdatasource({data:d.element,reader:new k(new m),loading:$.proxy(h,this),loaded:$.proxy(i,this)});else if($.isArray(b))a=new wijdatasource({data:b,reader:new k(new wijarrayreader),loading:$.proxy(h,this),loaded:$.proxy(i,this)});else{a=new wijdatasource(b);a.reader=new k(b.reader);a.loading=$.proxy(function(c,a){$.isFunction(b.loading)&&b.loading(c,a);$.proxy(h,this)(c,a)},this);a.loaded=$.proxy(function(c,a){$.isFunction(b.loaded)&&b.loaded(c,a);$.proxy(i,this)(c,a)},this);if(a.proxy&&a.proxy.options){c=a.proxy.options.error;a.proxy.options.error=function(){s.apply(this,arguments);$.isFunction(c)&&c.apply(this,arguments)}}}return a}function h(d,a){f=false;e=false;g=null;c=null;b._dataLoading(a)}function i(j,n){d=true;if(l.dataMode()===$.wijmo.wijgrid.dataMode.dynamical){f=false;e=false}else{f=false;e=false}var k=[],g,m,h,a,i;for(g=0,m=j.items.length;g<m;g++){a=j.items[g];i=$.isArray(a)?[]:{};for(h in a)if(a.hasOwnProperty(h))i[h]={value:a[h],originalRowIndex:g};k.push(i)}c=k;b._dataLoaded(n)}function s(){b._ajaxError.apply(b,arguments)}function j(){return!a.data?$.wijmo.wijgrid.dataMode.dom:a.dynamic===true?$.wijmo.wijgrid.dataMode.dynamical:$.wijmo.wijgrid.dataMode.statical}function p(a){if($.isArray(a))return a.length;else{var c=0,b;for(b in a)if(a.hasOwnProperty(b))c++;return c}}function q(){if(c&&c.length){var g=[],i,f,j,h,e,a,d;$.wijmo.wijgrid.traverse(b.options.columns,function(a){$.wijmo.wijgrid.validDataKey(a.dataKey)&&g.push(a)});i=Math.min(g.length,l.getFieldsCount());for(f=0,j=c.length;f<j;f++){h=c[f];for(e=0;e<i;e++){a=null;d=g[e];if(d&&d.dataParser){a=b._parse(d,h[d.dataKey].value);switch(d.dataType){case"datetime":if(a!==null&&!(a instanceof Date))throw"invalid value.";break;case"number":case"currency":if(a!==null&&(typeof a!=="number"||isNaN(a)))throw"invalid value.";break;case"boolean":if(a!==null&&(typeof a!=="boolean"||isNaN(a)))throw"invalid value.";}h[d.dataKey].value=a}}}}}function r(){if(c&&c.length){var e=b._buildFilterInfo(true),a=null,d;a=null;if(b.options.allowSorting)a=b._buildSortInfo(true);d=(new $.wijmo.wijgrid.dataHelper).getDataSlice(b,$.extend(true,[],c),e,a);return d}return{data:[],totalRows:0}}function o(){return{filtering:b._buildFilterInfo(false),paging:b.options.allowPaging?{pageIndex:b.options.pageIndex,pageSize:b.options.pageSize}:null,sorting:b._buildSortInfo(false)}}function k(a){this.read=function(b){b.items=null;a&&$.isFunction(a.read)&&a.read(b);if(!$.isArray(b.items)){b.items=[];if($.isArray(b.data))b.items=b.data;else if(b.data&&$.isArray(b.data.rows))b.items=b.data.rows}if(j()===$.wijmo.wijgrid.dataMode.dynamical)if(!b.data||isNaN(b.data.totalRows))throw"totalRows value is missing";if(!b.items||!$.isArray(b.items))b.items=[]}}function m(){this.read=function(b){b.items=[];if(b&&b.data&&b.data.length){b.items=a(b.data);b.data=null}else throw"invalid data source";};function a(j){var i=[],f=j.find("> tbody:first"),d,b,h,e,c,a,g;if(f.length){d=f[0];for(b=0,h=d.rows.length;b<h;b++){e=d.rows[b];c=[];for(a=0,g=e.cells.length;a<g;a++)c[a]=e.cells[a].innerHTML;i[b]=c}}return i}}},dataHelper:function(){this.getDataSlice=function(d,c,j,l){c=a(c,j,d);d.options.allowSorting&&$.proxy(b,this)(c,l);var k=c.length,e,i,g,f,h,m;if(d.options.allowPaging){e=Math.min(c.length-1,d.options.pageIndex*d.options.pageSize);if(e<0)e=0;i=Math.min(c.length,e+d.options.pageSize);g=[];for(f=e,m=0,h=0;f<i;f++,h++)g[h]=c[f];c=g}return{data:c,totalRows:k}};function a(e,d,o){var k,g,j={},a,b,l,i,m=[],h,f,c,n;if(!e||(k=e.length)===0||!d||(g=d.length)===0)return e;for(a=0;a<g;a++){b=d[a];l=b.operator;i=b.column;if(l.arity>1)j[a]=o._parse(i,i.filterValue)}for(a=0;a<k;a++){h=e[a];f=true;for(c=0;c<g&&f;c++){b=d[c];n=h[b.column.dataKey].value;f&=b.operator.operator(n,j[c])}f&&m.push($.extend(true,[],h))}return m}function b(i,f){if(f.length){var b=[],e,h,d,a,c,g;b.push("var _wijgriddatahelper = this;");b.push("var _wijgridSortFunc = function(a, b)\n{\n");for(e=0,h=f.length;e<h;e++){d="arg"+e;a=f[e];c=typeof a.dataKey==="string"?'"'+a.dataKey+'"':a.dataKey;if(a.sortDirection==="ascending"||a.sortDirection==="descending")if(a.sortDirection==="ascending")b.push("var ",d," = _wijgriddatahelper._sortAsc","(a[",c,"].value, b[",c,"].value);\n");else b.push("var ",d," = _wijgriddatahelper._sortDesc","(a[",c,"].value, b[",c,"].value);\n");else b.push("var ",d," = _wijgriddatahelper._sortDigitAsc","(a[",c,"].originalRowIndex, b[",c,"].originalRowIndex);\n");b.push("if (",d," == 0)\n");b.push("{\n")}g=f.length-1;if(g>=0){d="arg"+g;a=f[g];c=typeof a.dataKey==="string"?'"'+a.dataKey+'"':a.dataKey;if(a.sortDirection==="ascending"||a.sortDirection==="descending")if(a.sortDirection==="ascending")b.push("var ",d," = _wijgriddatahelper._sortDigitAsc","(a[",c,"].originalRowIndex, b[",c,"].originalRowIndex);\n");else b.push("var ",d," = _wijgriddatahelper._sortDigitDesc","(a[",c,"].originalRowIndex, b[",c,"].originalRowIndex);\n")}for(e=f.length-1;e>=0;e--){b.push("}\n");d="arg"+e;b.push("return ",d,";\n")}b.push("}");eval(b.join(""));i.sort(_wijgridSortFunc)}}this._sortAsc=function(a,b){if(a instanceof Date)a=a.getTime();if(b instanceof Date)b=b.getTime();return a===b?0:a===null?-1:b===null?1:a<b?-1:1};this._sortDesc=function(a,b){if(a instanceof Date)a=a.getTime();if(b instanceof Date)b=b.getTime();return a===b?0:a===null?1:b===null?-1:a<b?1:-1};this._sortDigitAsc=function(a,b){return a-b};this._sortDigitDesc=function(a,b){return b-a}}});$.extend($.wijmo.wijgrid,{groupRange:function(c,f,g,e){this.value=-1;switch(arguments.length){case 4:this.isExpanded=c;this.cr=f;this.sum=g;this.position=e;break;case 1:this.isExpanded=c;this.cr=new $.wijmo.wijgrid.cellRange(-1,-1);this.sum=-1;this.position="none";break;default:this.isExpanded=false;this.cr=new $.wijmo.wijgrid.cellRange(-1,-1);this.sum=-1;this.position="none"}this.isSubRange=function(a){return this.cr.r1>=a.cr.r1&&this.cr.r2<=a.cr.r2};this.toString=function(){return this.cr.r1+"-"+this.cr.r2};this._getHeaderImageClass=function(b){var a=this.owner;return a?b?a.expandedImageClass||"ui-icon-minus":a.collapsedImageClass||"ui-icon-plus":null};this.collapse=function(){var a,g,e,b,c,f;if((a=this.owner)&&(g=a.owner)&&(e=g.owner)){b=new $.wijmo.wijgrid.groupHelper;c=e._field("leaves");if(b.isParentExpanded(c,this.cr,a.level))if(a.position!=="footer"&&a.outlineMode!=="none"){f=b.getGroupedColumnsCount(c);d(b,e._rows(),c,this,f)}}};this.expand=function(h){var d,g,e,a,c,f;if((d=this.owner)&&(g=d.owner)&&(e=g.owner)){a=new $.wijmo.wijgrid.groupHelper;c=e._field("leaves");if(a.isParentExpanded(c,this.cr,d.level)){f=a.getGroupedColumnsCount(c);b(a,e._rows(),c,this,f,h,true)}}};function d(m,e,o,c,l){var j=c.owner,i=c.cr.r1,n=c.cr.r2,b,d,k,h,f,g;switch(j.position){case"header":case"headerAndFooter":b=e.item(c.cr.r1);if(b){if(b[0])b[0]["aria-expanded"]="false";if(b[1])b[1]["aria-expanded"]="false"}i++}for(d=i;d<=n;d++){b=e.item(d);if(b){if(b[0]){b[0].style.display="none";b[0]["aria-hidden"]="true"}if(b[1]){b[1].style.display="none";b[1]["aria-hidden"]="true"}}}c.isExpanded=false;a(e,c);for(d=j.level+1;d<=l;d++){h=m.getChildGroupRanges(o,c.cr,c.owner.level);for(g=0,k=h.length;g<k;g++){f=h[g];f.isExpanded=false;switch(f.owner.position){case"header":case"headerAndFooter":b=e.item(f.cr.r1);if(b){if(b[0])b[0]["aria-expanded"]="false";if(b[1])b[1]["aria-expanded"]="false"}}a(e,f)}}}function b(o,e,p,f,n,g,i){var r=f.owner,k=f.cr.r1,l=f.cr.r2,c,d,m,j,h,q;switch(r.position){case"header":c=e.item(k);if(c){if(c[0]){c[0].style.display="";c[0]["aria-hidden"]="false";if(i||g)c[0]["aria-expanded"]="true"}if(c[1]){c[1].style.display="";c[1]["aria-hidden"]="false";if(i||g)c[1]["aria-expanded"]="true"}}k++;break;case"footer":c=e.item(l);if(c){if(c[0]){c[0].style.display="";c[0]["aria-hidden"]="false"}if(c[1]){c[1].style.display="";c[1]["aria-hidden"]="false"}}l--;break;case"headerAndFooter":c=e.item(k);if(c){if(c[0]){c[0].style.display="";c[0]["aria-hidden"]="false";if(i||g)c[0]["aria-expanded"]="true"}if(c[1]){c[1].style.display="";c[1]["aria-hidden"]="false";if(i||g)c[1]["aria-expanded"]="true"}}if(i){c=e.item(l);if(c){if(c[0]){c[0].style.display="";c[0]["aria-hidden"]="false"}if(c[1]){c[1].style.display="";c[1]["aria-hidden"]="false"}}}k++;l--}if(i){f.isExpanded=true;a(e,f)}else return;if(f.owner.level===n)for(d=k;d<=l;d++){c=e.item(d);if(c){if(c[0]){c[0].style.display="";c[0]["aria-hidden"]="false"}if(c[1]){c[1].style.display="";c[1]["aria-hidden"]="false"}}}else{j=o.getChildGroupRanges(p,f.cr,f.owner.level);if(g)for(d=0,m=j.length;d<m;d++){h=j[d];b(o,e,p,h,n,g,true)}else for(d=0,m=j.length;d<m;d++){h=j[d];q=h.owner.position==="footer"||h.owner.outlineMode==="none"?true:false;b(o,e,p,h,n,false,q)}}}function a(d,a){if(a.owner.position!=="footer"){var b=null,c=d.item(a.cr.r1);if(c)if(c[0])b=$(c[0]).find("div.wijmo-wijgrid-grouptogglebtn:first-child");if(b&&b.length){b.toggleClass(a._getHeaderImageClass(!a.isExpanded),false);b.toggleClass(a._getHeaderImageClass(a.isExpanded),true)}}}},grouper:function(){this.group=function(e,g,c){this._grid=e;this._data=g;this._leaves=c;this._visibleLeaves=e._field("visibleLeaves");this._groupRowIdx=0;this._groupHelper=new $.wijmo.wijgrid.groupHelper;var d=1,b,f,a;for(b=0,f=c.length;b<f;b++){a=c[b];this._groupRowIdx=0;if(a.dynamic!==true&&a.groupInfo&&(a.groupInfo.position&&a.groupInfo.position!=="none")&&a.dataIndex>=0){a.groupInfo.level=d;a.groupInfo.expandInfo=[];this._processRowGroup(a,d++)}}delete this._grid;delete this._data;delete this._leaves;delete this._visibleLeaves};this._processRowGroup=function(i,b){for(var a,h,l,k,c,g,d,f,e,j=0;j<this._data.length;j++){if(!(this._data[j].rowType&$.wijmo.wijgrid.rowType.data))continue;a=this._getGroupCellRange(j,i,b);h=true;l=i.groupInfo.outlineMode==="startCollapsed";if(l||this._groupHelper.isParentCollapsed(this._leaves,a,b)){if(i.groupInfo.groupSingleRow===false&&a.r1===a.r2)continue;h=false}if(b&&this._grid.options.groupIndent)for(k=a.r1;k<=a.r2;k++)this._addIndent(this._data[k][0],b);switch(i.groupInfo.position){case"header":c=this._addGroupRange(i.groupInfo,a,h);this._updateByGroupRange(c,b);g=this._groupHelper.isParentCollapsed(this._leaves,c.cr,b);d=this._buildGroupRow(c,a,true,g);for(e=a.r1;e<=a.r2;e++){this._data[e].__attr["aria-level"]=b+1;if(!h){this._data[e].__style.display="none";this._data[e].__attr["aria-hidden"]=true}}this._data.splice(a.r1,0,d);d.__attr["arial-level"]=b;d.__attr["aria-expanded"]=h;if(g){d.__style.display="none";d.__attr["aria-hidden"]=true}j=a.r2+1;break;case"footer":c=this._addGroupRange(i.groupInfo,a,true);this._updateByGroupRange(c,b);f=this._buildGroupRow(c,a,false,false);f.__attr["aria-level"]=b;this._data.splice(a.r2+1,0,f);j=a.r2+1;g=this._groupHelper.isParentCollapsed(this._leaves,c.cr,b);if(g){f.__style.display="none";f.__attr["aria-hidden"]=true}break;case"headerAndFooter":c=this._addGroupRange(i.groupInfo,a,h);this._updateByGroupRange(c,b);g=this._groupHelper.isParentCollapsed(this._leaves,c.cr,b);d=this._buildGroupRow(c,a,true,g);f=this._buildGroupRow(c,a,false,false);for(e=a.r1;e<=a.r2;e++){this._data[e].__attr["aria-level"]=b+1;if(!h){this._data[e].__style.display="none";this._data[e].__attr["aria-hidden"]=true}}this._data.splice(a.r2+1,0,f);f.__attr["aria-level"]=b;if(g||!h){f.__style.display="none";f.__attr["aria-hidden"]=true}this._data.splice(a.r1,0,d);d.__attr["aria-level"]=b;d.__attr["aria-expanded"]=h;if(g){d.__style.display="none";d.__attr["aria-hidden"]=true}j=a.r2+2;break;default:throw $.wijmo.wijgrid.stringFormat('Unknown Position value: "{0}"',i.groupInfo.position);}this._groupRowIdx++}};this._buildGroupRow=function(l,g,e){var d=l.owner,a=d.owner,q=a.owner,f=[],i="",p,h,n=0,j="",b,o,m,c,k;f.__style={};f.__attr={};f.__attr.id=(e?"GH":"GF")+this._groupRowIdx+"-"+d.level;f.rowType=e?$.wijmo.wijgrid.rowType.groupHeader:$.wijmo.wijgrid.rowType.groupFooter;if(a.dataIndex>=0&&(p=this._data[g.r1][a.dataIndex].value)!==null)i=q._toStr(a,p);this._grid.options.showRowHeader&&f.push({html:"&nbsp;"});h={html:""};if(e&&d.outlineMode!=="none")if(l.isExpanded)h.html='<div class="ui-icon '+l._getHeaderImageClass(true)+' wijmo-wijgrid-grouptogglebtn">&nbsp;</div>';else h.html='<div class="ui-icon '+l._getHeaderImageClass(false)+' wijmo-wijgrid-grouptogglebtn">&nbsp;</div>';f.push(h);if(a.aggregate&&a.aggregate!=="none"){j=this._getAggregate(g,a,a,e,i);if(a.parentVis)n=1}b=e?d.headerText:d.footerText;if(b==="custom"){o={data:this._data,column:a,groupByColumn:d.owner,groupText:i,text:"",groupingStart:g.r1,groupingEnd:g.r2,isGroupHeader:e,aggregate:j};if(this._grid._trigger("grouptext",null,o))b=o.text}else{if(b===undefined||b===null){if(e)b="{1}: {0}";if(j||j===0)b=b?b+" {2}":"{2}"}b=$.wijmo.wijgrid.stringFormat(b,i,a&&a.headerText?a.headerText:"",j.toString())}if(!b)b="&nbsp;";h.html+="<span>"+b+"</span>";this._addIndent(h,d.level-1);m=n;c=this._grid.options.showRowHeader?1:0;for(;c<g.c1;c++)if(this._leaves[c].parentVis)m++;c=g.c1+n;for(;c<this._leaves.length;c++){a=this._leaves[c];if(a.dynamic!==true&&a.aggregate&&a.aggregate!=="none")break;if(a.parentVis)m++}for(;c<this._leaves.length;c++){a=this._leaves[c];if(a.parentVis){k=this._getAggregate(g,a,d.owner,e,i);if(!k&&k!==0)k="&nbsp;";f.push({html:k.toString()})}}h.colSpan=m;return f};this._getAggregate=function(c,a,g,h,i){var b="",f,e,d;if(!a.parentVis||!a.aggregate||a.aggregate==="none")return b;if(a.aggregate==="custom"){f={data:this._data,column:a,groupByColumn:g,groupText:i,text:"",groupingStart:c.r1,groupingEnd:c.r2,isGroupHeader:h};if(this._grid._trigger("groupaggregate",null,f))b=f.text}else{e=new this._tally;for(d=c.r1;d<=c.r2;d++)e.add(this._data[d][a.dataIndex].value);b=e.getValueString(a)}return b};this._getGroupCellRange=function(b,c,g){var h=c.leavesIdx,a=new $.wijmo.wijgrid.cellRange(b,h),d=this._groupHelper.getParentGroupRange(this._leaves,a,g),f,e;if(this._data[b].rowType&$.wijmo.wijgrid.rowType.data){f=this._data[b][c.dataIndex].value;for(a.r2=b,e=this._data.length-1;a.r2<e;a.r2++){if(!(this._data[a.r2+1].rowType&$.wijmo.wijgrid.rowType.data)||d&&a.r2+1>d.r2)break;if(this._data[a.r2+1][c.dataIndex].value!==f)break}}return a};this._addGroupRange=function(a,b,h){var c=null,e=this._groupHelper.getChildGroupIndex(b,a.expandInfo),g,f,i,d;if(e>=0&&e<a.expandInfo.length)c=a.expandInfo[e];else{g=new $.wijmo.wijgrid.cellRange(b.r1,b.r1,b.r2,b.r2);f=a.position==="footer"?true:h&&a.outlineMode!=="startCollapsed";c=new $.wijmo.wijgrid.groupRange(f,g,-1,a.position);c.owner=a;a.expandInfo.push(c)}if(c){i=b.r1;d=b.r2;if(a.position==="headerAndFooter")d+=2;if(a.position!=="headerAndFooter")d++;c.cr.r2=d}return c};this._updateByGroupRange=function(c,i){var d,h,b,g,e,a,f;for(d=0,h=this._leaves.length;d<h;d++){b=this._leaves[d].groupInfo;if(b&&b.level<i){g=b.expandInfo?b.expandInfo.length:0;for(e=0;e<g;e++){a=b.expandInfo[e];f=c.position==="headerAndFooter"?2:1;if(a.cr.r1>=c.cr.r1&&!(a.cr.r1===c.cr.r1&&a.position==="footer"))a.cr.r1+=f;if(a.cr.r2>=c.cr.r1)a.cr.r2+=f}}}};this._addIndent=function(c,b){var a;if(b>0&&(a=this._grid.options.groupIndent))c.paddingLeft=a*b+"px"};this._tally=function(){this._sum=0;this._sum2=0;this._cntNumbers=0;this._cntStrings=0;this._max=0;this._min=0;this._minString=undefined;this._maxString=undefined;this.add=function(a){if(a===null||a==="")return;this._cntStrings++;if(typeof a==="string"){if(this._minString===undefined||a<this._minString)this._minString=a;if(this._maxString===undefined||a>this._maxString)this._maxString=a;a=this._parseValue(a)}if(!isNaN(a)){if(this._cntNumbers===0){this._min=a;this._max=a}this._cntNumbers++;this._sum+=a;this._sum2+=a*a;if(a<this._min)this._min=a;if(a>this._max)this._max=a}};this.getValueString=function(a){if(this._cntNumbers){var c=this._getValue(a.aggregate),b=a.owner;return b._toStr(a,c)}if(this._cntStrings)switch(a.aggregate){case"max":return this._maxString;case"min":return this._minString;case"count":return this._cntStrings.toString()}return""};this._getValue=function(b){switch(b){case"average":return this._cntNumbers===0?0:this._sum/this._cntNumbers;case"count":return this._cntStrings;case"max":return this._max;case"min":return this._min;case"sum":return this._sum;case"std":return this._cntNumbers<=1?0:Math.sqrt(this._getValue("var"));case"stdPop":return this._cntNumbers<=1?0:Math.sqrt(this._getValue("varPop"));case"var":return this._cntNumbers<=1?0:this._getValue("varPop")*this._cntNumbers/(this._cntNumbers-1);case"vapPop":if(this._cntNumbers<=1)return 0;var a=this._sum/this._cntNumbers;return this._sum2/this._cntNumbers-a*a}return 0};this._parseValue=function(a){var d=false,c=a.length,b;if(c>0&&a.indexOf("%")===c-1){d=true;a=a.substr(0,c-1)}b=parseFloat(a);return isNaN(b)?NaN:d?b/100:b}}}});$.extend($.wijmo.wijgrid,{groupHelper:function(){this.getGroupInfo=function(c){if(c){if(!$.wijmo.wijgrid._getGroupInfoRegExp)$.wijmo.wijgrid._getGroupInfoRegExp=new RegExp(".*G([HF]){1}(\\d+)-(\\d+)$");var a=$.wijmo.wijgrid._getGroupInfoRegExp.exec(c.id),e,d,b;if(a){e=parseInt(a[3],10);d=parseInt(a[2],10);b=a[1]==="H";return{level:e,index:d,isHeader:b,toString:function(){return(this.isHeader?"GH":"GF")+this.index+"-"+this.level}}}}return null};this.getColumnByGroupLevel=function(c,e){var b,d,a;for(b=0,d=c.length;b<d;b++){a=c[b];if(a.groupInfo&&a.groupInfo.level===e)return a}return null};this.getGroupedColumnsCount=function(c){var d=0,a,e,b;for(a=0,e=c.length;a<e;a++){b=c[a].groupInfo;if(b&&b.position!=="none")d++}return d};this.getChildGroupIndex=function(f,e){var b=0,c=e.length-1,a,d;while(b<=c){a=(c-b>>1)+b;d=e[a].cr.r1-f.r1;if(d===0)return a;if(d<0)b=a+1;else c=a-1}return b};this.getParentGroupIndex=function(c,b){var a=this.getChildGroupIndex(c,b);if(a>0)a--;return a<b.length?a:-1};this.getChildGroupRanges=function(i,f,j){var g=[],a,c,b,h,e,d=this.getColumnByGroupLevel(i,j+1);if(d){a=d.groupInfo.expandInfo;e=this.getChildGroupIndex(f,a);for(b=e,h=a.length;b<h;b++){c=a[b];if(c.cr.r2<=f.r2)g.push(c);else break}}return g};this.getParentGroupRange=function(e,f,b){var c,a,d;if(b===undefined)b=65535;if(b-2>=0)for(c=e.length-1;c>=0;c--){a=e[c].groupInfo;if(!a||!a.expandInfo||a.level<0||a.level>=b)continue;d=this.getParentGroupIndex(f,a.expandInfo);if(d>=0)return a.expandInfo[d]}return null};this.isParentCollapsed=function(e,c,d){var b,a;if(d===1)return false;for(b=d;b>1;b--){a=this.getParentGroupRange(e,c,b);if(a&&!a.isExpanded)return true;c=a.cr}return false};this.isParentExpanded=function(e,c,d){var b,a;if(d===1)return true;for(b=d;b>1;b--){a=this.getParentGroupRange(e,c,b);if(a&&a.isExpanded)return true;c=a.cr}return false}}});$.extend($.wijmo.wijgrid,{cellRange:function(b,a,d,c){switch(arguments.length){case 2:this.r1=this.r2=b;this.c1=this.c2=a;break;case 4:this.r1=b;this.r2=d;this.c1=a;this.c2=c;break;default:this.r1=0;this.r2=0;this.c1=0;this.c2=0}this.isSingleCell=function(){return this.r1===this.r2&&this.c1===this.c2}},merger:function(){this.merge=function(e,c){this.leaves=c;this.data=e;var b,d,a;for(b=0,d=c.length;b<d;b++){a=c[b];a.dataIndex>=0&&!a.isBand&&(a.rowMerge==="free"||a.rowMerge==="restricted")&&this.mergeColumn(a)}delete this.data;delete this.leaves};this.mergeColumn=function(e){var d=e.dataIndex,b,g,a,f,c;for(b=0,g=this.data.length;b<g;b++){if(!(this.data[b].rowType&$.wijmo.wijgrid.rowType.data))continue;a=this.getCellRange(b,e);if(a.r1!==a.r2){f=a.r2-a.r1+1;this.data[a.r1][d].rowSpan=f;for(c=a.r1+1;c<=a.r2;c++)this.data[c][d].visible=false}b=a.r2}};this.getCellRange=function(b,g){var c=g.dataIndex,a=new $.wijmo.wijgrid.cellRange(b,c),j=this.data[b][c].value,i=this.data.length,d,f,e,h;for(a.r2=b;a.r2<i-1;a.r2++){d=this.data[a.r2+1];if(!(d.rowType&$.wijmo.wijgrid.rowType.data)||d[c].value!==j)break}f=g.leavesIdx;if(f>0&&g.rowMerge==="restricted"){e=this.leaves[f-1];if(e.dataIndex>=0){h=this.getCellRange(b,e);a.r1=Math.max(a.r1,h.r1);a.r2=Math.min(a.r2,h.r2)}}return a}}});$.extend($.wijmo.wijgrid,{rowType:{header:1,data:2,dataAlt:4,filter:8,groupHeader:16,groupFooter:32},stringFormat:function(a){if(!a)return"";for(var b=1,c=arguments.length;b<c;b++)a=a.replace(new RegExp("\\{"+(b-1)+"\\}","gm"),arguments[b]);return a},validDataKey:function(a){return a&&!(a<0)||a===0},iterateChildrenWidgets:function(a,b){if(a&&b){if(a.nodeType)a=$(a);a.find(".ui-widget").each(function(a,c){$.each($(c).data(),function(d,c){c.widgetName&&d!=="owner"&&b(a,c)})})}},domSelection:function(a){this.getSelection=function(){var b=0,c=0,d;if(a.selectionStart){b=a.selectionStart;c=a.selectionEnd}else if(document.selection){d=document.selection.createRange().duplicate();c=d.text.length;b=Math.abs(d.moveStart("character",-a.value.length));c+=b}return{start:b,end:c,length:c-b}};this.setSelection=function(c){if(a.selectionStart)a.setSelectionRange(c.start,c.end);else{var b=a.createTextRange();b.collapse(true);b.moveStart("character",c.start);b.moveEnd("character",c.end);b.select()}}},bounds:function(c,d){if(c){var b=c.nodeType?$(c):c,a=b.offset();if(a)return d?{top:a.top,left:a.left,width:b[0].clientWidth||0,height:b[0].clientHeight||0}:{top:a.top,left:a.left,width:b.outerWidth(),height:b.outerHeight()}}return null},_getDOMText:function(a,c,b){if(b===undefined)b=0;if(a&&(!c||c&&b<2))if(a.nodeType===3)return a.nodeValue;else if(a.nodeType===1){switch(a.type){case"button":case"text":case"textarea":case"select-one":return a.value;case"checkbox":return a.checked.toString()}for(var e="",d=0;a.childNodes[d];d++)e+=this._getDOMText(a.childNodes[d],c,b+1);return e}return""},ensureTBody:function(a){return a?a.tBodies&&a.tBodies.length>0?a.tBodies[0]:a.appendChild(document.createElement("tbody")):null}});$.extend($.wijmo.wijgrid,{measurments:[],timerOn:function(a){this.measurments[a]=(new Date).getTime()},timerOff:function(a){var b=((new Date).getTime()-this.measurments[a])/1e3;delete this.measurments[a];return b},shallowMerge:function(d,c){if(c&&d){var a,e,b;for(a in c)if(c.hasOwnProperty(a)){e=c[a];b=typeof e;if((b==="string"||b==="boolean"||b==="number")&&d[a]===undefined)d[a]=e}}}});var wijgridStringParser={parseDOM:function(d,b,c,a){return this.parse($.wijmo.wijgrid._getDOMText(d,true),b,c,a)},parse:function(a,c,d,b){return a===null||a===b?null:a===undefined||a==="&nbsp;"?"":""+a},toStr:function(a,c,d,b){return a===null?b:a}},wijgridNumberParser={parseDOM:function(d,b,c,a){return this.parse($.wijmo.wijgrid._getDOMText(d,true),b,c,a)},parse:function(a,c,d,b){return typeof a==="number"&&isNaN(a)?NaN:!a&&a!==0||a==="&nbsp;"||a===b?null:$.parseFloat(a,10,c.name)},toStr:function(b,d,a,c){return b===null?c:$.format(b,a?a:"n",d.name)}},wijgridCurrencyParser={parseDOM:function(d,b,c,a){return this.parse($.wijmo.wijgrid._getDOMText(d,true),b,c,a)},parse:function(a,b,d,c){if(typeof a==="number"&&isNaN(a))return NaN;if(!a&&a!==0||a==="&nbsp;"||a===c)return null;if(typeof a==="string")a=a.replace(b.numberFormat.currency.symbol,"");return $.parseFloat(a,10,b.name)},toStr:function(b,d,a,c){return b===null?c:$.format(b,a?a:"c",d.name)}},wijgridDateTimeParser={parseDOM:function(d,b,c,a){return this.parse($.wijmo.wijgrid._getDOMText(d,true),b,c,a)},parse:function(a,c,d,b){if(a instanceof Date)return a;if(!a||a==="&nbsp;"||a===b)return null;var e=$.parseDate(a,d,c.name);return e},toStr:function(b,d,a,c){return b===null?c:$.format(b,a?a:"d",d.name)}},wijgridBoolParser={parseDOM:function(d,b,c,a){return this.parse($.wijmo.wijgrid._getDOMText(d,true),b,c,a)},parse:function(a,d,e,c){var b=typeof a;if(b==="boolean")return a;if(b==="string")a=$.trim(a);if(!a||a==="&nbsp;"||a===c)return null;switch(a.toLowerCase()){case"true":return true;case"false":return false}return NaN},toStr:function(a,c,d,b){return a===null?b:a?"true":"false"}};$.extend($.wijmo.wijgrid,{filterOperatorsCache:function(){var a={};this.add=function(b){if(b&&b.name&&b.operator){var c=b.name.toLowerCase();if(!a[c])a[c]=b}};this.clear=function(){a.length=0};this.getByName=function(b){return a[b.toLowerCase()]};this.getByDataType=function(e){var d=[],c,b;for(c in a)if(a.hasOwnProperty(c)){b=a[c];$.inArray(e,b.applicableTo)>=0&&d.push(b)}return d};this.removeCustom=function(){for(var b in a)if(a[b].custom)delete a[b]};this.sort=function(a,e){switch(e.toLowerCase()){case"alphabetical":a.sort(d);break;case"alphabeticalcustomfirst":a.sort(c);break;case"alphabeticalembeddedFirst":a.sort(b)}return a};function d(c,d){var a=c.name.toLowerCase(),b=d.name.toLowerCase();if(a!==b){if(a==="nofilter")return-1;if(b==="nofilter")return 1}return a===b?0:a<b?-1:1}function b(c,d){var a=c.name.toLowerCase(),b=d.name.toLowerCase();if(a!==b){if(a==="nofilter")return-1;if(b==="nofilter")return 1}if(c.custom!==d.custom){if(c.custom)return 1;if(d.custom)return-1}return a===b?0:a<b?-1:1}function c(c,d){var a=c.name.toLowerCase(),b=d.name.toLowerCase();if(a!==b){if(a==="nofilter")return-1;if(b==="nofilter")return 1}if(c.custom!==d.custom){if(c.custom)return-1;if(d.custom)return 1}return a===b?0:a<b?-1:1}}});$.wijmo.wijgrid.embeddedFilters=[{name:"NoFilter",arity:1,applicableTo:["string","number","datetime","currency","boolean"],operator:function(){return true}},{name:"Contains",arity:2,applicableTo:["string"],operator:function(a,b){return a===b?true:a?a.indexOf(b)>=0:false}},{name:"NotContain",arity:2,applicableTo:["string"],operator:function(a,b){return a===b?false:a?a.indexOf(b)<0:true}},{name:"BeginsWith",arity:2,applicableTo:["string"],operator:function(a,b){return a===b?true:a?a.indexOf(b)===0:false}},{name:"EndsWith",arity:2,applicableTo:["string"],operator:function(a,b){if(a===b)return true;if(a){var c=a.lastIndexOf(b);return c>=0?a.length-c===b.length:false}return false}},{name:"Equals",arity:2,applicableTo:["string","number","datetime","currency","boolean"],operator:function(b,a){if(b instanceof Date)b=b.getTime();if(a instanceof Date)a=a.getTime();return b===a}},{name:"NotEqual",arity:2,applicableTo:["string","number","datetime","currency","boolean"],operator:function(b,a){if(b instanceof Date)b=b.getTime();if(a instanceof Date)a=a.getTime();return b!==a}},{name:"Greater",arity:2,applicableTo:["string","number","datetime","currency","boolean"],operator:function(b,a){if(b instanceof Date)b=b.getTime();if(a instanceof Date)a=a.getTime();return b>a}},{name:"Less",arity:2,applicableTo:["string","number","datetime","currency","boolean"],operator:function(b,a){if(b instanceof Date)b=b.getTime();if(a instanceof Date)a=a.getTime();return b<a}},{name:"GreaterOrEqual",arity:2,applicableTo:["string","number","datetime","currency","boolean"],operator:function(b,a){if(b instanceof Date)b=b.getTime();if(a instanceof Date)a=a.getTime();return b>=a}},{name:"LessOrEqual",arity:2,applicableTo:["string","number","datetime","currency","boolean"],operator:function(b,a){if(b instanceof Date)b=b.getTime();if(a instanceof Date)a=a.getTime();return b<=a}},{name:"IsEmpty",arity:1,applicableTo:["string"],operator:function(a){return!a&&a!==0&&a!==false}},{name:"NotIsEmpty",arity:1,applicableTo:["string"],operator:function(a){return!!a||a===0||a===false}},{name:"IsNull",arity:1,applicableTo:["string","number","datetime","currency","boolean"],operator:function(a){return a===null}},{name:"NotIsNull",arity:1,applicableTo:["string","number","datetime","currency","boolean"],operator:function(a){return a!==null}}];$.extend($.wijmo.wijgrid,{htmlTableAccessor:function(d){var b=[],c=0,a=d;e();function e(){var f=[],e,h,n,k,g,d,m,j,l,i;for(h=0,n=a.rows.length;h<n;h++){e=[];b[h]=e;k=a.rows[h];for(g=0,d=0,m=k.cells.length;g<m;g++,d++){j=k.cells[g];for(;f[d]>1;d++){f[d]--;e[d]={cellIdx:-1,colIdx:-1}}if(!(f[d]>1))f[d]=j.rowSpan;e[d]={cellIdx:g,colIdx:-1};e[g].colIdx=d;l=j.colSpan;for(;l>1;l--)e[++d]={cellIdx:-1,colIdx:-1}}i=f.length;for(;d<i;d++){f[d]--;e[d]={cellIdx:-1,colIdx:-1}}c=Math.max(c,i)}}this.element=function(){return d};this.getCellIdx=function(a,d){return a<c?b[d][a].cellIdx:-1};this.getColumnIdx=function(a,e){if(typeof a!=="number"){var d=a;a=d.cellIndex;e=d.parentNode.rowIndex}return a<c?b[e][a].colIdx:-1};this.getSectionLength=function(d){var b=a,c;switch(d){case 1:b=a.tHead;break;case 2:if((c=a.tBodies)&&c.length)b=c[0];break;case 3:b=a.tFoot}return b?b.rows.length:0};this.getSectionRow=function(d,e){var b=a,c;switch(e){case 1:b=a.tHead;break;case 2:if((c=a.tBodies)&&c.length)b=c[0];break;case 3:b=a.tFoot}return b?b.rows[d]:undefined};this.forEachColumnCellNatural=function(c,g,h){var b,f,e,d;for(b=0,f=a.rows.length;b<f;b++){e=a.rows[b];if(c<e.cells.length){d=g(e.cells[c],c,h);if(d!==true)return d}}return true};this.forEachColumnCell=function(h,i,j){var c,f,g,d,e;for(c=0,f=b.length;c<f;c++){g=a.rows[c];d=this.getCellIdx(h,c);if(d>=0){e=i(g.cells[d],c,j);if(e!==true)return e}}return true};this.forEachRowCell=function(g,f,h){var e=a.rows[g],b,d,c;for(b=0,d=e.cells.length;b<d;b++){c=f(e.cells[b],b,h);if(c!==true)return c}return true};this.colGroupTag=function(){var b=a.getElementsByTagName("colgroup");return b!==null&&b.length>0?b[0]:null};this.colTags=function(){var a=this.colGroupTag();return a!==null?a.getElementsByTagName("col"):[]}}});$.wijmo.wijgrid.cellInfo=function(b,a){var d=false,c=null;this.cellIndex=function(a){if(a===undefined)return b;b=a};this.column=function(){if(c&&this._isValid()){var a=c._getDataToAbsOffset();return c._field("visibleLeaves")[b+a.x]}return null};this.rowIndex=function(b){if(b===undefined)return a;a=b};this.isEqual=function(c){return c&&c.rowIndex()===a&&c.cellIndex()===b};this.tableCell=function(){if(c&&this._isValid()){var d=c._getDataToAbsOffset();return c._field("view").getCell(b+d.x,a+d.y)}return null};this.container=function(){var b=this.tableCell(),a;if(b){a=$(b).children("div.wijmo-wijgrid-innercell");if(a)return a}return null};this.value=function(d){var b,e,f;if(c&&this._isValid()){e=c.dataTable[a];if(e.rowType&$.wijmo.wijgrid.rowType.data){b=this.column();if(arguments.length===0)return e[b.dataIndex].value;else{d=c._parse(b,d);if(d===null&&b.valueRequired||b.dataType&&b.dataType!=="string"&&isNaN(d))throw"invalid value";f=e[b.dataIndex];f.value=d;c._dataStore.updateValue(f.originalRowIndex,b.dataKey,d)}}}};this.toString=function(){return b+":"+a};this._dataToAbs=function(c){b-=c.x;a-=c.y;return this};this._clip=function(e){var d=false,c;if(b<(c=e.topLeft().cellIndex())){d=true;b=c}if(b>(c=e.bottomRight().cellIndex())){d=true;b=c}if(a<(c=e.topLeft().rowIndex())){d=true;a=c}if(a>(c=e.bottomRight().rowIndex())){d=true;a=c}return d};this._clone=function(){return new $.wijmo.wijgrid.cellInfo(b,a)};this._row=function(){return c&&this._isValid()?c._rows().item(a):null};this._isValid=function(){return b>=0&&a>=0};this._isEdit=function(a){if(!arguments.length)return d;d=a};this._setGridView=function(a){c=a}};$.wijmo.wijgrid.cellInfo.prototype.outsideValue=new $.wijmo.wijgrid.cellInfo(-1,-1);$.wijmo.wijgrid.cellInfoRange=function(d,c){if(!d||!c)throw"invalid arguments";var a=d._clone(),b=c._clone();this.bottomRight=function(){return b};this.isEqual=function(c){return c&&a.isEqual(c.topLeft())&&b.isEqual(c.bottomRight())};this.topLeft=function(){return a};this.toString=function(){return a.toString()+" - "+b.toString()};this._isIntersect=function(c){var d,f,e,g;if(c){d=c.bottomRight().rowIndex()-c.topLeft().rowIndex()+1;f=b.rowIndex()-a.rowIndex()+1;if(c.topLeft().rowIndex()+d-a.rowIndex()<d+f){e=c.bottomRight().cellIndex()-c.topLeft().cellIndex()+1;g=b.cellIndex()-a.cellIndex()+1;return c.topLeft().cellIndex()+e-a.cellIndex()<e+g}}return false};this._isValid=function(){return a._isValid()&&b._isValid()};this._clip=function(c){return a._clip(c)|b._clip(c)};this._clone=function(){return new $.wijmo.wijgrid.cellInfoRange(a._clone(),b._clone())};this._containsCellInfo=function(c){return c&&c.cellIndex()>=a.cellIndex()&&c.cellIndex()<=b.cellIndex()&&c.rowIndex()>=a.rowIndex()&&c.rowIndex()<=b.rowIndex()};this._containsCellRange=function(a){return a&&this._containsCellInfo(a.topLeft())&&this._containsCellInfo(a.bottomRight())};this._extend=function(d,c){if(d===1){a.rowIndex(c.topLeft().rowIndex());b.rowIndex(c.bottomRight().rowIndex())}else if(d===2){a.cellIndex(c.topLeft().cellIndex());b.cellIndex(c.bottomRight().cellIndex())}return this};this._normalize=function(){var c=a.cellIndex(),e=a.rowIndex(),d=b.cellIndex(),f=b.rowIndex();a.cellIndex(Math.min(c,d));a.rowIndex(Math.min(e,f));b.cellIndex(Math.max(c,d));b.rowIndex(Math.max(e,f))}};$.extend($.wijmo.wijgrid,{flatView:function(a){var b=null,d=null,c=18;this.initialize=function(){b=null;d=null;this._createLayout()};this._createLayout=function(){a.options.scrollMode!=="none"&&a.outerDiv.wrapInner('<div class="wijmo-wijgrid-fixedview"><div class="wijmo-wijgrid-split-area wijmo-wijgrid-split-area-se wijmo-wijgrid-content-area"></div></div>')};this._testNeedVBar=function(i,b,f){var a,h,e,g,d;h=b.width();e=b.height();g=i.width();d=i.height();b[0].style.width==="auto"&&b.css("width","");if(f==="both"||f==="vertical")a=true;else if(f==="auto")if(e>d)a=true;else if(h>g&&e>d-c)a=true;return a};this.updateSplits=function(){var h=this,o=false,d=a.element,k=[],i,p,g,r,l,j,q,e,f,m,n;e=a.options;i=a._field("visibleLeaves");p=b.colTags();$.each(i,function(b,a){if(a.width){o=true;p[b].width=a.width}});r=a.options.scrollMode;l=a.outerDiv;if(e.scrollMode!=="none"||o||e.allowColSizing||e.allowEditing||e.autoExpandColumnIndex){g=e.scrollMode==="none"?l:l.find(".wijmo-wijgrid-content-area");h._testNeedVBar(a.outerDiv,d,r)&&g.width(g.width()-c);if(g.innerWidth()>d[0].offsetWidth)if(e.autoExpandColumnIndex){d.css("width","auto");j=g.innerWidth()}else{d.css("width","100%");j=d[0].offsetWidth}$.each(i,function(a){h.setColumnWidth(a,null,k)});$.each(k,function(a,b){h.setColumnWidth(a,b);o&&$(p[a]).removeAttr("width")});d.css("width","auto");if(!isNaN(j)&&i.length>0){q=d[0].offsetWidth;m=j-q;if(m!==0){n=k.length-1;f=e.autoExpandColumnIndex||n;if(f>n)f=n;m&&h.setColumnWidth(f,k[f]+m)}}}else l.innerWidth()>d[0].offsetWidth&&d.css("width","100%");h.refreshPanel()};this.setColumnWidth=function(d,a,c){var b=this.getHeaderCell(d);if(b){a=a?a:b.clientWidth;if(c){c.push(a);return}if(a){$(b).children("div.wijmo-wijgrid-innercell").setOutWidth(a);this.forEachColumnCell(d,function(c){var b=$(c.parentNode);b.parent().is("tbody")&&!b.is(".wijmo-wijgrid-groupheaderrow",".wijmo-wijgrid-groupfooterrow")&&$(c).children("div.wijmo-wijgrid-innercell").setOutWidth(a);return true})}}};this._getMappedScrollMode=function(){var d=a.options.scrollMode,c="auto",b="auto";switch(d){case"horizontal":c="hidden";b="visible";break;case"vertical":c="visible";b="hidden";break;case"both":c="visible";b="visible"}return{vScrollBarVisibility:c,hScrollBarVisibility:b}};this.refreshPanel=function(){var e=a.options.scrollMode,d=a.outerDiv,b,c;if(e!=="none"){b=d.find(".wijmo-wijgrid-content-area");c=this._getMappedScrollMode();b.width(this._getGridWidth(e));b.height(d.innerHeight());if(!b.data("wijsuperpanel"))b.wijsuperpanel({vScroller:{scrollBarVisibility:c.vScrollBarVisibility},hScroller:{scrollBarVisibility:c.hScrollBarVisibility}});else b.wijsuperpanel("paintPanel")}};this._getGridWidth=function(e){var b=a.element.width(),d=a.outerDiv.innerWidth();if(this._testNeedVBar(a.outerDiv,a.element,e))b+=c;if(b>d)b=d;return b};this.render=function(){var p=a._field("visibleLeaves"),s=a.element[0],r=null,q,g,J,j,H,d,L,h,b,k,o,t,i,x,K,A,D,z,u,B,I,c,C,n,l,m,G,E,f,y,w,v,F;q=a._field("spanTable");if(q&&q.length){r=s.createTHead();J=q[0].length;for(j=0,H=q.length;j<H;j++){d=r.insertRow(-1);d.className="wijmo-wijgrid-headerrow";d.role="row";L=0;for(h=0;h<J;h++){g=q[j][h];if(g.column&&(g.column.visible||g.column.visible===undefined)){g.column.thX=L++;g.column.thY=j;b=$(document.createElement("th"));if(h===0&&a.options.showRowHeader){b.addClass("ui-state-default wijmo-wijgrid-rowheader");b.attr({role:"rowheader",scope:"row"})}else b.attr({role:"columnheader",scope:"col"});g.colSpan>1&&b.attr("colSpan",g.colSpan);g.rowSpan>1&&b.attr("rowSpan",g.rowSpan);k=$('<div class="wijmo-wijgrid-innercell"></div>');b.append(k);d.appendChild(b[0]);a.cellFormatter.format(k,g.column,g.column.headerText,$.wijmo.wijgrid.rowType.header,null)}}a._rowCreated(d,null,$.wijmo.wijgrid.rowType.header,null)}}if(a.options.showFilter){if(!r)r=s.createTHead();d=r.insertRow(-1);d.className="wijmo-wijgrid-filterrow";d.role="row";for(o=0,t=p.length;o<t;o++){i=p[o];b=$(d.insertCell(-1)).attr("role","gridcell");a.cellFormatter.format(b,i,i.filterValue,$.wijmo.wijgrid.rowType.filter,null)}a._rowCreated(d,null,$.wijmo.wijgrid.rowType.filter,null)}x=document.createElement("colgroup");for(o=0,t=p.length;o<t;o++){K=document.createElement("col");x.appendChild(K)}s.appendChild(x);A=a.dataTable;D=a.data();z=$.wijmo.wijgrid.ensureTBody(s);u=0;B=$.wijmo.wijgrid.getAriaHeaders(p,$.wijmo.wijgrid.flatten(a.options.columns));for(j=0,I=A.length;j<I;j++){c=A[j];v=c.rowType&$.wijmo.wijgrid.rowType.data?D[c[0].originalRowIndex]:null;C=c.length;d=z.insertRow(-1);d.role="row";n="wijmo-wijgrid-row ui-widget-content";switch(c.rowType){case $.wijmo.wijgrid.rowType.data:case $.wijmo.wijgrid.rowType.data|$.wijmo.wijgrid.rowType.dataAlt:n+=" wijmo-wijgrid-datarow";d.setAttribute("dataRowIndex",u);if(c.rowType&$.wijmo.wijgrid.rowType.dataAlt)n+=" wijmo-wijgrid-alternatingrow";u++;break;case $.wijmo.wijgrid.rowType.groupHeader:n+=" wijmo-wijgrid-groupheaderrow";break;case $.wijmo.wijgrid.rowType.groupFooter:n+=" wijmo-wijgrid-groupfooterrow"}if(n)d.className=n;l=c.__style;for(m in l)if(l.hasOwnProperty(m))d.style[m]=l[m];l=c.__attr;for(m in l)if(l.hasOwnProperty(m))d[m]=l[m];for(h=0,G=p.length;h<G;h++){i=p[h];E=i.dataIndex;f=0;y=false;switch(c.rowType){case $.wijmo.wijgrid.rowType.data:case $.wijmo.wijgrid.rowType.data|$.wijmo.wijgrid.rowType.dataAlt:f=E;if(f>=0&&(!c[f]||c[f].visible===false))continue;break;case $.wijmo.wijgrid.rowType.groupHeader:case $.wijmo.wijgrid.rowType.groupFooter:f=h;if(f>=C)y=true}if(y)break;b=$(document.createElement("td"));if(h===0&&a.options.showRowHeader){b.addClass("wijmo-wijgrid-rowheader");b.attr({role:"rowheader",scope:"row"})}else b.attr("role","gridcell");b.addClass("wijgridtd");k=$('<div class="wijmo-wijgrid-innercell"></div>');b.append(k);if(f>=0){c[f].rowSpan>1&&b.attr("rowSpan",c[f].rowSpan);c[f].colSpan>1&&b.attr("colSpan",c[f].colSpan);c[f].paddingLeft&&k.css("padding-left",c[f].paddingLeft)}d.appendChild(b[0]);if(c.rowType&$.wijmo.wijgrid.rowType.data&&i.dataParser){b.attr("headers",B[h]);i.readOnly&&b.attr("aria-readonly","true");w=null;if(f>=0){b.addClass("wijdata-type-"+(i.dataType||"string"));F=c[f].value;w=a._toStr(i,F)}a.cellFormatter.format(k,i,w,c.rowType,v)}else f>=0&&k.html(c[f].html)}if(!d.cells.length)z.removeChild(d);else a._rowCreated(d,null,c.rowType,v)}e()};this.attachEvents=function(){};this.subTables=function(){return[b]};this.focusableElement=function(){return b.element()};this.forEachRowCell=function(c,a,d){return b.forEachRowCell(c,a,d)};this.forEachColumnCell=function(c,a,d){return b.forEachColumnCell(c,a,d)};this.ensureWidth=function(a,b){arguments.length>0&&this.setColumnWidth(b,a);this.refreshPanel()};this.getCell=function(e,c){var d=b.getCellIdx(e,c),a;if(d>=0){a=this.getJoinedRows(c,0);if(a[0])return a[0].cells[d]}return null};this.getAbsoluteRowIndex=function(a){return a.rowIndex};this.getJoinedCols=function(c){var a=$(b.element()).find("> colgroup");if(a.length)if(c<a[0].childNodes.length)return[a[0].childNodes[c],null];return[null,null]};this.getJoinedRows=function(a,c){return[b.getSectionRow(a,c),null]};this.getJoinedTables=function(c,a){return[b,null,a]};this.getHeaderCell=function(d){var c=a._field("visibleLeaves")[d],b=a._headerRows();return b?(new $.wijmo.wijgrid.rowAccessor).getCell(b.item(c.thY),c.thX):null};this.getAbsCellInfo=function(a){return new $.wijmo.wijgrid.cellInfo(b.getColumnIdx(a),a.parentNode.rowIndex)};this.getVisibleAreaBounds=function(){var c=$.wijmo.wijgrid.bounds(b.element()),d;if(a.options.scrollMode==="none")return c;else{d=$.wijmo.wijgrid.bounds(a.outerDiv.find(".wijmo-wijgrid-split-area-se:first")[0]);return{top:c.top,left:c.left,width:Math.min(d.width,c.width),height:Math.min(d.height,c.height)}}};function e(){a.element.addClass("wijmo-wijgrid-table").find("> tbody").addClass("ui-widget-content wijmo-wijgrid-data");b=new $.wijmo.wijgrid.htmlTableAccessor(a.element[0]);a.element.attr({role:"grid",cellpadding:"0",border:"0",cellspacing:"0"}).css("border-collapse","separate")}}});$.wijmo.wijgrid.selection=function(a){var f=0,j,d=new $.wijmo.wijgrid.cellInfoOrderedCollection(a),b=new $.wijmo.wijgrid.cellInfoOrderedCollection(a),c=new $.wijmo.wijgrid.cellInfoOrderedCollection(a),e=new $.wijmo.wijgrid.cellInfoOrderedCollection(a),h=null,i=null;this.selectedCells=function(){return c};this.addRange=function(b,e,d,f){if(!b&&arguments.length===1)throw"invalid argument";var c=arguments.length===4?new $.wijmo.wijgrid.cellInfoRange(new $.wijmo.wijgrid.cellInfo(b,e),new $.wijmo.wijgrid.cellInfo(d,f)):b._clone();c._normalize();if(!c._isValid())throw"invalid argument";this.beginUpdate();this._startNewTransaction(a._field("currentCell"));this._selectRange(c,false,true,0,null);this.endUpdate()};this.clear=function(){this.beginUpdate();b._clear();b._addFrom(c);this.endUpdate()};this.selectAll=function(){this.beginUpdate();this._selectRange(a._getDataCellsRange(),false,false,0,null);this.endUpdate()};this.beginUpdate=function(){f++};this.endUpdate=function(){if(f>0){f--;if(f===0){k();if(d.length()||b.length()){h!==null&&h.UnderlyingDataChanged();i!==null&&i.UnderlyingDataChanged();a._trigger("selectionchanged",null,{addedCells:d,removedCells:b})}d=new $.wijmo.wijgrid.cellInfoOrderedCollection(a);b._clear()}}};this._multipleRangesAllowed=function(){var b=a.options.selectionMode;return b&&((b=b.toLowerCase())==="multicolumn"||b==="multirow"||b==="multirange")};this._anchorCell=function(){return j};this._startNewTransaction=function(b){if(b){j=b._clone();e=new $.wijmo.wijgrid.cellInfoOrderedCollection(a)}};this._clearRange=function(l,p){var j=a.options.selectionMode.toLowerCase(),d,n,m,e,h,f,i,o,k;if(l._isValid()&&j!=="none"&&c.length()>0){d=l._clone();d._normalize();d._clip(a._getDataCellsRange());if(!l._isValid())return;d=g(d,j,p,null);this.beginUpdate();switch(j){case"singlecell":d._containsCellInfo(c.item(0))&&this.clear();break;case"singlecolumn":case"singlerow":case"singlerange":n=d.bottomRight().rowIndex();m=d.bottomRight().cellIndex();e=false;for(h=d.topLeft().rowIndex();!e&&h<=n;h++)for(f=d.topLeft().cellIndex();!e&&f<=m;f++){e=c.indexOf(f,h)>=0;e&&this.clear()}break;case"multicolumn":case"multirow":case"multirange":for(i=0,o=c.length();i<o;i++){k=c.item(i);d._containsCellInfo(k)&&b._add(k)}}this.endUpdate()}};this._selectRange=function(h,k,f,i,j){var d=a.options.selectionMode.toLowerCase(),c;if(d!=="none"&&h._isValid()){c=h._clone();c._normalize();c._clip(a._getDataCellsRange());if(!c._isValid())return;this.beginUpdate();if(!this._multipleRangesAllowed())this.clear();else if(k||f){if(f){b._clear();b._addFrom(e)}}else this.clear();c=g(c,d,i,j);l(c,true);this.endUpdate()}};function g(b,f,e,c){var d=a._getDataCellsRange();switch(f){case"singlecell":b=c===null?new $.wijmo.wijgrid.cellInfoRange(b.topLeft(),b.topLeft()):new $.wijmo.wijgrid.cellInfoRange(c,c);break;case"singlecolumn":b=c===null?new $.wijmo.wijgrid.cellInfoRange(b.topLeft(),b.topLeft()):new $.wijmo.wijgrid.cellInfoRange(c,c);b._extend(1,d);break;case"singlerow":b=c===null?new $.wijmo.wijgrid.cellInfoRange(b.topLeft(),b.topLeft()):new $.wijmo.wijgrid.cellInfoRange(c,c);b._extend(2,d);break;case"singlerange":b._extend(e,d);break;case"multicolumn":b._extend(1,d);break;case"multirow":b._extend(2,d);break;case"multirange":b._extend(e,d)}return b}function k(){var m=a._getDataToAbsOffset(),k=m.x,l=m.y,n=a._field("view"),g,i,f,h,j;for(g=0,i=b.length();g<i;g++){f=b.item(g);if(d.indexOf(f)<0){h=n.getCell(f.cellIndex()+k,f.rowIndex()+l);h&&$(h).removeClass("ui-state-highlight").removeAttr("aria-selected");c._remove(f);e._remove(f)}else{b._removeAt(g);g--;i--}}for(g=0,i=d.length();g<i;g++){f=d.item(g);j=c.indexOf(f);if(j<0){h=n.getCell(f.cellIndex()+k,f.rowIndex()+l);h&&$(h).addClass("ui-state-highlight").attr("aria-selected","true");c._insertUnsafe(f,~j);e._add(f)}else{d._removeAt(g);g--;i--}}}function l(f,l){var h=f.topLeft().cellIndex(),j=f.topLeft().rowIndex(),i=f.bottomRight().cellIndex(),k=f.bottomRight().rowIndex(),g,c,a,e;if(l){g=d.length();for(c=j;c<=k;c++)for(a=h;a<=i;a++){e=new $.wijmo.wijgrid.cellInfo(a,c);if(g===0)d._appendUnsafe(e);else d._add(e)}}else{g=b.length();for(c=j;c<=k;c++)for(a=h;a<=i;a++){e=new $.wijmo.wijgrid.cellInfo(a,c);if(g===0)b._appendUnsafe(e);else b._add(e)}}}};$.wijmo.wijgrid.cellInfoOrderedCollection=function(b){if(!b)throw"argument is null";var a=[];this.item=function(b){return a[b]};this.length=function(){return a.length};this.indexOf=function(e,h){if(arguments.length===1){h=e.rowIndex();e=e.cellIndex()}var d=0,g=a.length-1,c,f,b;while(d<=g){c=d+(g-d>>1);f=a[c];b=f.rowIndex()-h;if(b===0)b=f.cellIndex()-e;if(b<0)d=c+1;else if(b>0)g=c-1;else return c}return~d};this.toString=function(){var d="",b,c;for(b=0,c=a.length;b<c;b++)d+=a[b].toString()+"\n";return d};this._add=function(c){var d=this.indexOf(c);if(d<0){a.splice(~d,0,c);c._setGridView(b);return true}return false};this._addFrom=function(d){if(d){var e=d.length(),f=a.length,c;if(f===0){a.length=e;for(c=0;c<e;c++){a[c]=d.item(c);a[c]._setGridView(b)}}else for(c=0;c<e;c++)this._add(d.item(c))}};this._appendUnsafe=function(c){a[a.length]=c;c._setGridView(b)};this._insertUnsafe=function(c,b){a.splice(b,0,c)};this._clear=function(){a.length=0};this._remove=function(c){var b=this.indexOf(c);if(b>=0){a.splice(b,1);return true}return false};this._removeAt=function(b){a.splice(b,1)};this._getColumnsIndicies=function(){var e=[],d=a.length,c,b,f;if(d){c=[];for(b=0;b<d;b++)c[a[b].cellIndex()]=1;d=c.length;f=0;for(b=0;b<d;b++)if(c[b])e[f++]=b}return e};this._getSelectedRowsIndicies=function(){var f=[],d=a.length,c,b,e;if(d){c=[];for(b=0;b<d;b++)c[a[b].rowIndex()]=1;d=c.length;e=0;for(b=0;b<d;b++)if(c[b])f[e++]=b}return f};this._rectangulate=function(){var h=a.length,d=4294967295,f=4294967295,e=0,g=0,c,b;if(h){for(c=0;c<h;c++){b=a[c];d=Math.min(d,b.cellIndex());f=Math.min(f,b.rowIndex());e=Math.max(e,b.cellIndex());g=Math.max(g,b.rowIndex())}return new $.wijmo.wijgrid.cellInfoRange(new $.wijmo.wijgrid.cellInfo(d,f),new $.wijmo.wijgrid.cellInfo(e,g))}return null}};$.extend($.wijmo.wijgrid,{selectionui:function(a){var p=10,s="{0}."+a.widgetName+".selectionui",b=new $.wijmo.wijgrid.cellInfoOrderedCollection(a),j,d,f,c,g=false,i=false,h=a._field("view"),r=a._field("visibleLeaves").length;a.element.bind(e("mousedown"),o);this.dispose=function(){a.element.unbind(e("mousedown"),o);k()};function o(c){if(!a._canInteract()||a.options.selectionMode.toLowerCase()==="none")return;var b=h.getVisibleAreaBounds(),e={x:c.pageX,y:c.pageY},g=c.target&&c.target.tagName!==undefined?c.target.tagName.toLowerCase():undefined,f=$(c.target);if((!g||f.is("td.wijgridtd, th.wijgridtd, div.wijmo-wijgrid-innercell"))&&(e.x>b.left&&e.x<b.left+b.width)&&(e.y>b.top&&e.y<b.top+b.height)){q();j=e;d=l(j)}}function m(y){if(!d||!d._isValid())return;var u={x:y.pageX,y:y.pageY},v,i,n,m,x,w,r,q,k,o,e,s,t;if(!g)g=Math.abs(j.x-u.x)>p||Math.abs(j.y-u.y)>p;if(g){v=l(u);if(!v._isValid())return;f=v;i=new $.wijmo.wijgrid.cellInfoRange(d,f);i._normalize();i._clip(a._getDataCellsRange());if(i._isValid()&&!i.isEqual(c)){n=a._getDataToAbsOffset();c=i;m=new $.wijmo.wijgrid.cellInfoOrderedCollection(a);x=i.bottomRight().rowIndex();w=i.bottomRight().cellIndex();for(r=i.topLeft().rowIndex();r<=x;r++)for(q=i.topLeft().cellIndex();q<=w;q++)m._appendUnsafe(new $.wijmo.wijgrid.cellInfo(q,r));for(k=0,o=b.length();k<o;k++){e=b.item(k);if(m.indexOf(e)<0){if(a.selection().selectedCells().indexOf(e)<0){s=h.getCell(e.cellIndex()+n.x,e.rowIndex()+n.y);s&&$(s).removeClass("ui-state-highlight")}b._removeAt(k);k--;o--}}for(k=0,o=m.length();k<o;k++){e=m.item(k);if(b.indexOf(e)<0&&a.selection().selectedCells().indexOf(e)<0)if(b._add(e)){t=h.getCell(e.cellIndex()+n.x,e.rowIndex()+n.y);t&&$(t).addClass("ui-state-highlight")}}}}}function n(j){k();if(g){g=false;if(c&&c._isValid()){a._changeCurrentCell(f);(!j.shiftKey||!a.selection()._multipleRangesAllowed()&&a.options.selectionMode.toLowerCase()!=="singleRange")&&a.selection()._startNewTransaction(d);a.selection().beginUpdate();a.selection()._selectRange(c,j.shiftKey,j.ctrlKey,0,f);a.selection().endUpdate();var n=a._field("view"),l=a._getDataToAbsOffset(),h,m,e,i;for(h=0,m=b.length();h<m;h++){e=b.item(h);if(a.selection().selectedCells().indexOf(e)<0){i=n.getCell(e.cellIndex()+l.x,e.rowIndex()+l.y);i!==null&&$(i).removeClass("ui-state-highlight")}}b._clear();d=f=c=null;return false}}}function q(){if(!i)try{a.element.disableSelection();a.element.css({MozUserSelect:"none",WebkitUserSelect:"none"});$(document).bind(e("mousemove"),m).bind(e("mouseup"),n)}finally{i=true}}function k(){if(i)try{a.element.enableSelection();a.element.css({MozUserSelect:"",WebkitUserSelect:""});$(document).unbind(e("mousemove"),m).unbind(e("mouseup"),n)}finally{i=false}}function e(a){return $.wijmo.wijgrid.stringFormat(s,a)}function l(i){var c=0,e=r-1,b=0,k=-1,d,f,g,m,j,l;while(c<=e){b=(e-c>>1)+c;d=$.wijmo.wijgrid.bounds(h.getHeaderCell(b));if(i.x<d.left)e=b-1;else if(i.x>d.left+d.width)c=b+1;else{k=b;break}}if(k===-1)return $.wijmo.wijgrid.cellInfo.prototype.outsideValue;f=new $.wijmo.wijgrid.rowAccessor(h,0,0,0);g=-1;c=0;e=f.length()-1;b=0;while(c<=e){b=(e-c>>1)+c;m=f.item(b);d=$.wijmo.wijgrid.bounds(f.getCell(m,0));if(i.y<d.top)e=b-1;else if(i.y>d.top+d.height)c=b+1;else{g=b;break}}if(g===-1)return $.wijmo.wijgrid.cellInfo.prototype.outsideValue;j=a._getDataToAbsOffset();l=new $.wijmo.wijgrid.cellInfo(k-j.x,g-j.y);l._clip(a._getDataCellsRange());return l}}});$.wijmo.wijgrid.rowAccessor=function(d,c,a,b){if(!a)a=0;if(!b)b=0;this.item=function(b){var e=this.length();return b<e?d.getJoinedRows(b+a,c):null};this.length=function(){var g=d.getJoinedTables(true,0),e=0,f;if(f=g[0])e=f.getSectionLength(c);if(f=g[1])e+=f.getSectionLength(c);e-=a+b;if(e<0)e=0;return e};this.iterateCells=function(d,e,j){if(d&&e){var i=0,b,h,a,c,f,g;for(b=0,h=d.length;b<h;b++){a=d[b];if(a)for(c=0,f=a.cells.length;c<f;c++){g=e(a.cells[c],i++,j);if(g!==true)return}}}};this.getCell=function(d,b){var a,c;if(a=d[0]){c=a.cells.length;if(b<c)return a.cells[b];b-=c;if(a=d[1]){c=a.cells.length;if(b<c)return a.cells[b]}}return null};this.cellsCount=function(c){var b=0,a;if(a=c[0]){b=a.cells.Length;if(a=c[1])b+=a.cells.Length}return b}};$.extend($.wijmo.wijgrid,{cellEditorHelper:function(){this.currentCellEditStart=function(g,i){var e=false,a=g.currentCell(),c,h,f,d;if(a._isValid()&&!a._isEdit()&&a.column().dataIndex>=0){c=a._row();if(c&&c.length){h=c[0].attributes.dataRowIndex!==undefined?parseInt(c[0].attributes.dataRowIndex.value,10):undefined;if(h!==undefined){f={cell:a,event:i,handled:false};if(e=g._trigger("beforecelledit",null,f))if(!f.handled)e=b(g,f);if(e){a._isEdit(true);if(g.options.showRowHeader){d=$(c[0].cells[0]).children("div.wijmo-wijgrid-innercell");if(d.length){d.empty();d.append($("<div>&nbsp;</div>").addClass("ui-icon ui-icon-pencil"))}}}}}}return e};this.currentCellEditEnd=function(e,i){var a=e.currentCell(),f=false,g,k,j,b,h,l,m,n;if(!a._isValid()||!a._isEdit())return;g=a._row();if(g&&g.length){k=g[0].attributes.dataRowIndex!==undefined?parseInt(g[0].attributes.dataRowIndex.value,10):undefined;if(k===undefined)return f;j=i&&i.which===$.ui.keyCode.ESCAPE;if(!i||!j){b={cell:a,value:undefined};if(f=e._trigger("beforecellupdate",null,b)){if(b.value===undefined)b.value=d(e,a);h=false;if(b.cell.column().dataType==="datetime"){l=b.value?b.value.getTime():null;m=a.value()?a.value().getTime():null;h=l!==m}else h=b.value!==a.value();if(h){try{a.value(b.value)}catch(o){f=false;e._trigger("invalidcellvalue",null,{cell:a,value:b.value})}f&&e._trigger("aftercellupdate",null,{cell:a})}}}else f=true;if(f){b={cell:a,event:i,handled:false};e._trigger("aftercelledit",null,b);if(!b.handled)f=c(e,b);f&&a._isEdit(false);e.options.showRowHeader&&$(g[0].cells[0]).children("div.wijmo-wijgrid-innercell").html("&nbsp;");e.element.focus();$(e._field("view").focusableElement()).focus();a.tableCell().focus()}}return f};function b(j,c){var i=c.cell.column(),g=false,e,f,b,h,d;if(i.dataIndex>=0){e=c.cell.value();g=true;try{f=c.cell.container();if(i.dataType==="boolean"){b=f.children("input");b.focus().one("keyup",function(a){if(c.event.which===$.ui.keyCode.SPACE){a.preventDefault();b[0].checked=!e}})}else{b=$("<input />").attr("type","text").addClass("wijgridinput wijmo-wijinput ui-state-focus").bind("keydown",j,a);if(c.event&&c.event.type==="keypress"&&c.event.which)b.val(String.fromCharCode(c.event.which));else switch(c.cell.column().dataType){case"currency":case"number":if(e!==null){b.val(e);break}default:b.val(j._toStr(c.cell.column(),e))}f.empty().append(b);h=b.val().length;(new $.wijmo.wijgrid.domSelection(b[0])).setSelection({start:h,end:h});b.focus();$.browser.msie&&setTimeout(function(){b.focus()},0);if($.browser.mozilla&&document.createEvent&&b[0].dispatchEvent){d=document.createEvent("KeyboardEvent");d.initKeyEvent("keypress",false,true,null,false,false,false,false,0,$.ui.keyCode.SPACE);b[0].dispatchEvent(d);d=document.createEvent("KeyboardEvent");d.initKeyEvent("keypress",false,true,null,false,false,false,false,$.ui.keyCode.BACKSPACE,0);b[0].dispatchEvent(d)}}}catch(k){alert(k.message);g=false}}return g}function c(c,b){var a=b.cell.column(),g=false,d,e,f,i,h;if(a.dataIndex>=0){g=true;try{d=b.cell.container();e=c._toStr(a,b.cell.value());f=c.dataTable[b.cell.rowIndex()];i=c.data()[f[0].originalRowIndex];if(a.dataType==="boolean"){h=d.children("input");if(e==="true")h.attr("checked","checked");else h.removeAttr("checked")}else c.cellFormatter.format(d,a,e,f.rowType,i)}catch(j){alert("defaultAfterCellEdit: "+j.message);g=false}}return g}function a(a){if(a.which===$.ui.keyCode.ENTER){var b=a.data;if(b){b._endEditInternal(a);return false}}}function d(d,c){var a=c.container().find(":input:first"),b=null;if(a.length){b=a.attr("type")==="checkbox"?a[0].checked:a.val();b=d._parse(c.column(),b)}return b}}});$.extend($.wijmo.wijgrid,{fixedView:function(a){var i,b={},f,d,g,e,c,h=18;this.element=a.element;this.initialize=function(){i=a.dataTable.length;this._createLayout()};this._createLayout=function(){a.outerDiv.wrapInner('<div class="wijmo-wijgrid-fixedview"><div class="wijmo-wijgrid-scroller"><div class="wijmo-wijgrid-split-area-se wijmo-wijgrid-content-area"></div></div></div>');c=a.outerDiv.find(".wijmo-wijgrid-scroller");c.after('<div class="wijmo-wijgrid-split-area wijmo-wijgrid-split-area-nw" style="overflow:hidden;position:absolute;z-index:4;top:0px;left:0px;"></div>');c.after('<div class="wijmo-wijgrid-split-area wijmo-wijgrid-split-area-ne" style="overflow:hidden;position:absolute;z-index:4;top:0px;left:0px;"></div>');c.after('<div class="wijmo-wijgrid-split-area wijmo-wijgrid-split-area-sw" style="overflow:hidden;position:absolute;z-index:4;top:0px;left:0px;"></div>')};this._onScrolled=function(){a.outerDiv.find(".wijmo-wijgrid-split-area-ne")[0].scrollLeft=parseInt((a.outerDiv.find(".wijmo-wijsuperpanel-templateouterwrapper").css("left")+"").replace("px",""),10)*-1};this._onScrolling=function(c,b){if(b.dir==="h")a.outerDiv.find(".wijmo-wijgrid-split-area-ne")[0].scrollLeft=parseInt((a.outerDiv.find(".wijmo-wijsuperpanel-templateouterwrapper").css("left")+"").replace("px",""),10)*-1;else a.outerDiv.find(".wijmo-wijgrid-split-area-sw")[0].scrollTop=parseInt((a.outerDiv.find(".wijmo-wijsuperpanel-templateouterwrapper").css("top")+"").replace("px",""),10)*-1};this._testNeedVBar=function(j,c,k,f){var b,i,e,g,d;i=Math.max(c.width(),k.width());e=c.height()+a.options.splitDistanceY;g=j.width();d=j.height();c[0].style.width==="auto"&&c.css("width","");if(f==="both"||f==="vertical")b=true;else if(f==="auto")if(e>d)b=true;else if(i>g&&e>d-h)b=true;return b};this.updateSplits=function(){var f=a.options,g=this,p,r,k,i,b,w,q,u,t,l,m,v,n,j,o,s;try{if(f.staticRowIndex>=0)f.splitDistanceY=a.outerDiv.find(".wijmo-wijgrid-split-area-ne table")[0].offsetHeight;else f.splitDistanceY=0;if(a._staticColumnIndex>=0)f.splitDistanceX=a.outerDiv.find(".wijmo-wijgrid-split-area-nw table")[0].offsetWidth;else f.splitDistanceX=0}catch(x){}this._updateSplitAreaBounds();q=a.element.find("tbody .wijmo-wijgrid-row:not(.wijmo-wijgrid-groupheaderrow):first");u=q.clone().removeAttr("datarowindex").addClass("wijmo-wijgrid-foorow").appendTo(q.parent()).show().height(0).css({"font-size":"0"});g.fooRowCells=u.find(">td").height(0).css({"border-top":"0","border-bottom":"0"}).find(">div.wijmo-wijgrid-innercell").empty();b=$(e.element());o=$(d.element());p=e.colTags();k=a._field("visibleLeaves");i=[];w=f.scrollMode;t=a.outerDiv;g._testNeedVBar(a.outerDiv,b,o,w)&&c.width(c.width()-h);s=Math.max(b.width(),o.width());if(s<t.innerWidth())if(f.autoExpandColumnIndex){b.css("width","auto");l=c.innerWidth()}else{b.css("width","100%");l=b.width()}$.each(k,function(b,a){if(a.width){r=true;p[b].width=a.width}});$.each(k,function(a){g.setColumnWidth(a,null,i)});$.each(i,function(a,b){g.setColumnWidth(a,b);r&&$(p).removeAttr("width")});b.css("width","auto");if(!isNaN(l)&&k.length>0){v=b.width();m=l-v;if(m!==0){n=i.length-1;j=f.autoExpandColumnIndex||n;if(j>n)j=n;m&&g.setColumnWidth(j,i[j]+m)}}g.refreshPanel()};this.setColumnWidth=function(d,c,a){var f=this.getHeaderCell(d),e=null,b=f.clientWidth,g=false;if(c){if(!a){$(f).children("div.wijmo-wijgrid-innercell").setOutWidth(c);this.fooRowCells.eq(d).setOutWidth(c)}this.forEachColumnCell(d,function(d){var b=$(d.parentNode);if(b.parent().is("tbody")&&!b.is(".wijmo-wijgrid-groupheaderrow",".wijmo-wijgrid-groupfooterrow"))if(a){a.push(c);return false}else $(d).children("div.wijmo-wijgrid-innercell").setOutWidth(c);return true})}else{this.forEachColumnCell(d,function(d){var c=$(d.parentNode);if(c.parent().is("tbody")&&!c.is(".wijmo-wijgrid-groupheaderrow",".wijmo-wijgrid-groupfooterrow")){if(!g){if(!c.is(":visible")){e=c;c.show()}b=Math.max(b,d.clientWidth);g=true}if(!a)$(d).children("div.wijmo-wijgrid-innercell").setOutWidth(b);else return false}return true});if(a)a.push(b);else $(f).children("div.wijmo-wijgrid-innercell").setOutWidth(b);e&&e.hide()}};this._getMappedScrollMode=function(){var d=a.options.scrollMode,c="auto",b="auto";switch(d){case"horizontal":c="hidden";b="visible";break;case"vertical":c="visible";b="hidden";break;case"both":c="visible";b="visible"}return{vScrollBarVisibility:c,hScrollBarVisibility:b}};this.refreshPanel=function(){var b=this._getMappedScrollMode(),d;c.width(this._getGridWidth(a.options.scrollMode));if(!c.data("wijsuperpanel"))c.wijsuperpanel({scrolled:this._onScrolled,vScroller:{bubbleScrollingEvent:false,scrollBarVisibility:b.vScrollBarVisibility},hScroller:{scrollBarVisibility:b.hScrollBarVisibility}});else c.wijsuperpanel("paintPanel");d=a.outerDiv.find(".wijmo-wijgrid-split-area-ne");d.width(c.wijsuperpanel("getContentElement").parent().width());this._onScrolled()};this._getGridWidth=function(e){var b=a.element.outerWidth(true),c=a.outerDiv.innerWidth();if(this._testNeedVBar(a.outerDiv,a.element,$(d.element()),e))b+=h;if(b>c)b=c;return b};this._updateSplitAreaBounds=function(){var b=a.options,i=b.width||a.outerDiv.width(),d=b.height||a.outerDiv.height(),f,e,h,g;if(d<=0)d=a.outerDiv.find(".wijmo-wijgrid-split-area-se > table")[0].offsetHeight;if(a.outerDiv[0].style.height!==""&&a.outerDiv[0].style.height!=="auto")c.height(d);else c.height(d+b.splitDistanceY);c.width(i);f=a.outerDiv.find(".wijmo-wijgrid-split-area-nw");e=a.outerDiv.find(".wijmo-wijgrid-split-area-ne");h=a.outerDiv.find(".wijmo-wijgrid-split-area-sw");g=a.outerDiv.find(".wijmo-wijgrid-split-area-se");f.height(b.splitDistanceY);e.height(b.splitDistanceY);a.$topPagerDiv!==null&&e.css("top",a.$topPagerDiv.outerHeight(true)+"px");h.height(d-b.splitDistanceY).css("top",b.splitDistanceY);f.width(b.splitDistanceX);h.width(b.splitDistanceX);g.css("marginLeft",b.splitDistanceX);g.css("marginTop",b.splitDistanceY)};this.render=function(){var q=a._field("visibleLeaves"),D=document.createDocumentFragment(),u=a._field("spanTable"),Z=a._getRealStaticRowIndex(),A=a._staticColumnIndex,t={},X,o,V,f,Q,e=null,d=null,Y,i,m,c,x=null,w=null,k,G,n,p,h,v,F,E,O,R,l={},P,B,H,W,s,y,z,U,S,g,J,r,I,T,C,L,K,N,M;b.nw=D.appendChild(document.createElement("table"));b.ne=D.appendChild(document.createElement("table"));b.sw=D.appendChild(document.createElement("table"));$(D).append(a.element);b.se=a.element[0];if(u&&u.length){t.nw=b.nw.createTHead();t.ne=b.ne.createTHead();X=u[0].length;for(o=0,V=u.length;o<V;o++){e=null;d=null;e=t.nw.insertRow(-1);d=t.ne.insertRow(-1);e.className="wijmo-wijgrid-headerrow";d.className="wijmo-wijgrid-headerrow";e.role="row";d.role="row";Y=0;for(i=0;i<X;i++){m=u[o][i];if(m.column&&(m.column.visible||m.column.visible===undefined)){m.column.thX=Y++;m.column.thY=o;c=$(document.createElement("th"));if(i===0&&a.options.showRowHeader){c.addClass("ui-state-default wijmo-wijgrid-rowheader");c.attr({role:"rowheader",scope:"row"})}else c.attr({role:"columnheader",scope:"col"});m.colSpan>1&&c.attr("colSpan",m.colSpan);m.rowSpan>1&&c.attr("rowSpan",m.rowSpan);r=$('<div class="wijmo-wijgrid-innercell"></div>');c.append(r);if(i<=A)e.appendChild(c[0]);else d.appendChild(c[0]);a.cellFormatter.format(r,m.column,m.column.headerText,$.wijmo.wijgrid.rowType.header,null)}}a._rowCreated(e,d,$.wijmo.wijgrid.rowType.header,null)}}if(a.options.showFilter){if(t.nw){x=t.nw.insertRow(-1);x.className="wijmo-wijgrid-filterrow ui-widget-content";x.role="row";for(k=0,G=q.length;k<G;k++){n=q[k];c=$(x.insertCell(-1)).attr("role","gridcell");a.cellFormatter.format(c,n,null,$.wijmo.wijgrid.rowType.filter,null)}}if(t.ne){w=t.ne.insertRow(-1);w.className="wijmo-wijgrid-filterrow ui-widget-content";w.role="row";for(k=0,G=q.length;k<G;k++){n=q[k];c=$(w.insertCell(-1)).attr("role","gridcell");a.cellFormatter.format(c,n,null,$.wijmo.wijgrid.rowType.filter,null)}}a._rowCreated(x,w,$.wijmo.wijgrid.rowType.filter,null)}p={t0:b.nw,t1:b.sw};for(h in p)if(p.hasOwnProperty(h)){v=document.createElement("colgroup");for(k=0;k<=A;k++){F=document.createElement("col");v.appendChild(F)}E=p[h];E.appendChild(v)}p={t0:b.ne,t1:b.se};for(h in p)if(p.hasOwnProperty(h)){v=document.createElement("colgroup");for(k=A+1;k<q.length;k++){F=document.createElement("col");v.appendChild(F)}E=p[h];E.appendChild(v)}O=a.dataTable;R=a.data();l={};l.nw=$.wijmo.wijgrid.ensureTBody(b.nw);l.ne=$.wijmo.wijgrid.ensureTBody(b.ne);l.sw=$.wijmo.wijgrid.ensureTBody(b.sw);l.se=$.wijmo.wijgrid.ensureTBody(b.se);P=$.wijmo.wijgrid.getAriaHeaders(q,$.wijmo.wijgrid.flatten(a.options.columns));B=0;H=Z-(u.length+(a.options.showFilter?1:0));for(o=0,W=O.length;o<W;o++){f=O[o];C=f.rowType&$.wijmo.wijgrid.rowType.data?R[f[0].originalRowIndex]:null;Q=f.length;e=null;d=null;if(o<=H){e=l.nw.insertRow(-1);d=l.ne.insertRow(-1)}else{e=l.sw.insertRow(-1);d=l.se.insertRow(-1)}e.role="row";d.role="row";s="wijmo-wijgrid-row ui-widget-content";switch(f.rowType){case $.wijmo.wijgrid.rowType.data:case $.wijmo.wijgrid.rowType.data|$.wijmo.wijgrid.rowType.dataAlt:s+=" wijmo-wijgrid-datarow";e.setAttribute("dataRowIndex",B);d.setAttribute("dataRowIndex",B);if(f.rowType&$.wijmo.wijgrid.rowType.dataAlt)s+=" wijmo-wijgrid-alternatingrow";B++;break;case $.wijmo.wijgrid.rowType.groupHeader:s+=" wijmo-wijgrid-groupheaderrow";break;case $.wijmo.wijgrid.rowType.groupFooter:s+=" wijmo-wijgrid-groupfooterrow"}if(s){e.className=s;d.className=s}y=f.__style;for(h in y)if(y.hasOwnProperty(h)){e.style[h]=y[h];d.style[h]=y[h]}z=f.__attr;for(h in z)if(z.hasOwnProperty(h)){e[h]=z[h];d[h]=z[h]}for(i=0,U=q.length;i<U;i++){n=q[i];S=n.dataIndex;g=0;J=false;switch(f.rowType){case $.wijmo.wijgrid.rowType.data:case $.wijmo.wijgrid.rowType.data|$.wijmo.wijgrid.rowType.dataAlt:g=S;if(g>=0&&(!f[g]||f[g].visible===false))continue;break;case $.wijmo.wijgrid.rowType.groupHeader:case $.wijmo.wijgrid.rowType.groupFooter:g=i;if(g>=Q)J=true}if(J)break;c=$(document.createElement("td"));if(i===0&&a.options.showRowHeader){c.addClass("wijmo-wijgrid-rowheader");c.attr({role:"rowheader",scope:"row"})}else c.attr("role","gridcell");c.addClass("wijgridtd");r=$('<div class="wijmo-wijgrid-innercell"></div>');c.append(r);if(g>=0){f[g].rowSpan>1&&c.attr("rowSpan",f[g].rowSpan);f[g].colSpan>1&&c.attr("colSpan",f[g].colSpan);f[g].paddingLeft&&r.css("padding-left",f[g].paddingLeft)}if(i<=A)e.appendChild(c[0]);else d.appendChild(c[0]);if(f.rowType&$.wijmo.wijgrid.rowType.data&&n.dataParser){c.attr("headers",P[i]);n.readOnly&&c.attr("aria-readonly","true");I=null;if(g>=0){c.addClass("wijdata-type-"+(n.dataType||"string"));T=f[g].value;I=a._toStr(n,T)}a.cellFormatter.format(r,n,I,f.rowType,C)}else g>=0&&r.html(f[g].html)}if(o<=H){if(!e.cells.length){l.nw.removeChild(e);e=null}if(!d.cells.length){l.ne.removeChild(d);d=null}(e||d)&&a._rowCreated(e,d,f.rowType,C)}else{if(!e.cells.length){l.sw.removeChild(e);e=null}if(!d.cells.length){l.se.removeChild(d);d=null}(e||d)&&a._rowCreated(e,d,f.rowType,C)}}L=a.outerDiv.find(".wijmo-wijgrid-split-area-nw");K=a.outerDiv.find(".wijmo-wijgrid-split-area-ne");N=a.outerDiv.find(".wijmo-wijgrid-split-area-sw");M=a.outerDiv.find(".wijmo-wijgrid-content-area");L[0].innerHTML="";K[0].innerHTML="";N[0].innerHTML="";M[0].innerHTML="";$(b.nw).appendTo(L);$(b.ne).appendTo(K);$(b.sw).appendTo(N);$(b.se).appendTo(M);j()};this.attachEvents=function(){};this.updateCss=function(){};this.subTables=function(){return[f,d,g,e]};this.focusableElement=function(){return e.element()};this.forEachRowCell=function(h,f,g){var c=this.getJoinedTables(false,h),d=c[0],e=c[1],b,a;if(d!==null){b=c[2];if(b<d.element().rows.length){a=d.forEachRowCell(b,f,g);if(a!==true)return a}if(e!==null&&b<e.element().rows.length){a=e.forEachRowCell(b,f,g);if(a!==true)return a}}return true};this.forEachColumnCell=function(f,d,e){var b=this.getJoinedTables(true,f),c,a;if(b[0]!==null){c=b[2];a=b[0].forEachColumnCell(c,d,e);if(a!==true)return a;if(b[1]!==null){a=b[1].forEachColumnCell(c,d,e);if(a!==true)return a}}return true};this.ensureWidth=function(b,a){arguments.length>0&&this.setColumnWidth(a,b);this.refreshPanel()};this.getCell=function(g,h){var a=this.getJoinedTables(false,h),c,e,d,b,f;if(a[0]!==null){c=this.getJoinedTables(true,g);if(c[0]!==null){e=a[2];d=c[2];b=null;if(a[1]!==null)b=g===d?a[0]:a[1];else b=a[0];f=b.getCellIdx(d,e);if(f>=0)return b.element().rows[e].cells[f]}}return null};this.getColumnIndex=function(j){for(var b=null,c=null,i=false,h,b=j.parentNode;b.tagName.toLowerCase()!=="table";b=b.parentNode);if(b!==null){if(b===f.element())c=f;else if(b===d.element()){c=d;i=true}else if(b===g.element())c=g;else if(b===e.element()){c=e;i=true}if(c!==null){h=c.getColumnIdx(j);if(i)h+=a._staticColumnIndex+1;return h}}return-1};this.getAbsoluteRowIndex=function(c){var e=c.rowIndex,b=c.parentNode;while(b.tagName.toLowerCase()!=="table")b=b.parentNode;return b===f.element()||b===d.element()?e:e+a._getRealStaticRowIndex()+1};this.getJoinedCols=function(b){var c=[],a=this.getJoinedTables(true,b);a.splice(a.length-1,1);$.each(a,function(d,a){c.push($(a.element()).find("col")[b])});return c};this.getJoinedRows=function(j,k){var l=null,m=null,b=null,h=null,r=a._getRealStaticRowIndex(),c=a._staticColumnIndex,s=a._field("leaves").length-1,t=i-1,q=r===t,n=r<0,p=!q&&!n,o=0;if(q||p){if(c>=0&&c<s){b=f;h=d}else b=c<0?d:f;o=b.getSectionLength(k);if(j<o){l=b.getSectionRow(j,k);if(h!==null)m=h.getSectionRow(j,k)}}if(n||p&&l===null){if(!n)j-=o;if(c>=0&&c<s){b=g;h=e}else b=c<0?e:g;l=b.getSectionRow(j,k);if(h!==null)m=h.getSectionRow(j,k)}return l===null&&m===null?null:[l,m]};this.getJoinedTables=function(m,l){var b=null,c=null,h=l,k=a._getRealStaticRowIndex(),j=a._staticColumnIndex;if(m){if(l<=j){b=f;c=g}else{b=d;c=e;h=h-(j+1)}if(k<0)b=null;if(k===i-1)c=null}else{if(l<=k){b=f;c=d}else{b=g;c=e;h=h-(k+1)}if(j<0)b=null;if(j===a._field("leaves").length-1)c=null}if(b===null){b=c;c=null}return[b,c,h]};this.getHeaderCell=function(d){var c=a._field("visibleLeaves")[d],b=a._headerRows();return b?(new $.wijmo.wijgrid.rowAccessor).getCell(b.item(c.thY),c.thX):null};this.getAbsCellInfo=function(a){return new $.wijmo.wijgrid.cellInfo(this.getColumnIndex(a),this.getAbsoluteRowIndex(a.parentNode))};this.getVisibleAreaBounds=function(){return $.wijmo.wijgrid.bounds(a.outerDiv.find(".wijmo-wijsuperpanel-contentwrapper:first"))};this.adjustCellsSizes=function(){for(var l=new $.wijmo.wijgrid.rowAccessor(this,9,0),n=l.length(),m=[],b,g,c,j,e,h,d,k,f,i,o,a=0;a<n;a++){g=this.getJoinedRows(a,9);c=g[0];j=c!==null?c.cells.length:0;e=false;for(b=0;b<j&&!e;b++)e=c.cells[b].rowSpan>1;d=g[1];k=d!==null?d.cells.length:0;f=false;if(!e)for(b=0;b<k&&!f;b++)f=d.cells[b].rowSpan>1;h=c!==null&&j>0?c.offsetHeight:0;i=d!==null&&k>0?d.offsetHeight:0;m[a]=e||f?Math.min(h,i):Math.max(h,i)}for(a=0;a<n;a++){o=this.getJoinedRows(a,9);l.iterateCells(o,this.setCellContentDivHeight,m[a])}};this.setCellContentDivHeight=function(b,a){b.style.height=a+"px";return true};function j(){for(var a in b)b.hasOwnProperty(a)&&$(b[a]).addClass("wijmo-wijgrid-table").attr("role","grid").find("> tbody").addClass("ui-widget-content wijmo-wijgrid-data");f=new $.wijmo.wijgrid.htmlTableAccessor(b.nw);d=new $.wijmo.wijgrid.htmlTableAccessor(b.ne);g=new $.wijmo.wijgrid.htmlTableAccessor(b.sw);e=new $.wijmo.wijgrid.htmlTableAccessor(b.se);$(b.ne).attr({cellpadding:"0",border:"0",cellspacing:"0"}).css("border-collapse","separate");$(b.se).attr({cellpadding:"0",border:"0",cellspacing:"0"}).css("border-collapse","separate")}}});$.extend($.wijmo.wijgrid,{resizer:function(f){var h=[],s=10,r=1,u="{0}."+f.widgetName+".resizer",d=false,a=null,q,g=null,c=null,e=null;this.addElement=function(a){a.element.bind(b("mousemove"),p).bind(b("mousedown"),o).bind(b("mouseout"),i);h.push(a)};this.dispose=function(){$.each(h,function(c,a){a.element.unbind(b("mousemove"),p).unbind(b("mousedown"),o).unbind(b("mouseout"),i)});l()};function p(c){if(!d){var b=n({x:c.pageX,y:c.pageY});if(b&&b._canSize()&&f._canInteract()){b.element.css("cursor","e-resize");a=b}else i(c)}}function i(){if(!d)if(a){a.element.css("cursor","");a=null}}function o(b){a=n({x:b.pageX,y:b.pageY});if(a&&a._canSize()&&f._canInteract())try{a.element.css("cursor","");q=document.body.style.cursor;document.body.style.cursor="e-resize";g=c=$.wijmo.wijgrid.bounds(a.element);e=$('<div class="wijmo-wijgrid-resizehandle ui-state-highlight">&nbsp;</div>');e.css({left:b.pageX,top:g.top,height:f._field("view").getVisibleAreaBounds().height-a.element[0].offsetTop});$(document.body).append(e)}finally{t();d=true}}function j(a){var b=r*Math.round((a.pageX-c.left)/r);c={left:c.left+b,top:a.pageY};e.css("left",c.left)}function k(){try{document.body.style.cursor=q;e.remove();g!==c&&f._fieldResized(a,c.left-g.left)}finally{a=null;e=null;l();d=false}}function m(a){a.preventDefault()}function t(){if(!d){$(document).bind(b("mousemove"),j).bind(b("mouseup"),k);$(document.body).disableSelection();$.browser.msie&&$(document.body).bind("selectstart",m)}}function l(){if(d){$(document).unbind(b("mousemove"),j).unbind(b("mouseup"),k);$(document.body).enableSelection();$.browser.msie&&$(document.body).unbind("selectstart",m)}}function n(d){var b,e,c,a,f;for(b=0,e=h.length;b<e;b++){c=h[b];a=$.wijmo.wijgrid.bounds(c.element);f=$.ui.isOver(d.y,d.x,a.top,a.left+a.width-s,a.height,s);if(f)return c}return null}function b(a){return $.wijmo.wijgrid.stringFormat(u,a)}}});$.extend($.wijmo.wijgrid,{cellFormatterHelper:function(){this.format=function(f,a,e,i,h){var g=true,d=null;if($.isFunction(a.cellFormatter))g=!a.cellFormatter(f,a,e,i,h);if(g){switch(a.dataType){case"boolean":d=b;break;default:d=c}d&&d(f,a,e,i,h)}};function c(c,e,b,d){switch(d){case $.wijmo.wijgrid.rowType.filter:a(c,e);break;default:if(!b)b="&nbsp;";c.html(b)}}function b(c,d,k,j,i){var b,f,h="disabled='disabled'",e,g;switch(j){case $.wijmo.wijgrid.rowType.data:case $.wijmo.wijgrid.rowType.data|$.wijmo.wijgrid.rowType.dataAlt:b=d.owner;f=b.options.allowEditing&&d.readOnly!==true;if(f)h="";if(b._parse(d,i[d.dataKey])===true)c.html("<input class='wijgridinput' type='checkbox' checked='checked' "+h+" />");else c.html("<input class='wijgridinput' type='checkbox' "+h+" />");f&&c.children("input").bind("mousedown",function(){e=c.parent()[0];g=b.currentCell();g.tableCell()!==e&&b._onClick({target:e});!g._isEdit()&&b.beginEdit()}).bind("keydown",function(a){if(a.which===$.ui.keyCode.ENTER){b._endEditInternal(a);return false}});break;case $.wijmo.wijgrid.rowType.filter:a(c,d)}}function a(b,a){if(a.dataIndex>=0&&!a.isBand&&a.showFilter)b.html('<div class="wijmo-wijgrid-filter ui-widget ui-state-default ui-corner-all"><span class="wijmo-wijgrid-filtericon"></span><input type="text" class="wijmo-wijgrid-filter-input" style="width:1px" /><a class="wijmo-wijgrid-filter-trigger ui-corner-right ui-state-default" href="#"><span class="ui-icon ui-icon-triangle-1-s"></span></a></div>');else b.html("&nbsp;")}}});